<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Comparison Tool - C:\...\RF_Ident_CL_4_GUI_Ready.m vs. ...y_Update_17_09_2020_Onwards.m</title><style type="text/css">

pre {

  display:inline-block;

}

.diffnomatch {

  background: #e5d5e8;

     display: inline-block;

}

.right {

  background: #dbf2fc;

     display: inline-block;

}

.left {

  background: #f3e9d1;

     display: inline-block;

}

.diffsoft {

    color: #888;

}

.diffskip {

       color: #888;

  background: #e0e0e0;

     display: inline-block;

}

.bold {

  font-weight:bold;

}

.merged {

  background-color: #eaeaea;

           display: inline-block;

}

</style><body><div id="allContent"><table cellpadding="0" cellspacing="0" border="0"><tbody><tr>
<td></td><td><a id="leftFileLink" class="bold">RF_Ident_CL_4_GUI_Ready.m</a></td>
<td><a id="rightFileLink" class="bold">RF_Ident_CL_4_GUI_Ready_Update_17_09_2020_Onwards.m</a></td>
</tr>
<tr>
<td></td><td>C:\Users\Marvin Seifert\Documents\MATLAB\APP_master\Paul_RF_code\RF_Ident_CL_4_GUI_Ready.m</td><td>C:\Users\Marvin Seifert\Documents\MATLAB\APP_master\Zipped Files for Marvin\RF_Ident_CL_4_GUI_Ready_Update_17_09_2020_Onwards.m</td>
</tr>
<tr>
<td></td><td>Mon Nov 30 16:58:00 GMT 2020</td><td>Fri Sep 25 17:31:20 BST 2020</td>
</tr>
<tr>
<td><pre>    </pre></td>
<td><pre>                                                                                </pre></td>
<td><pre>                                                                                </pre></td>
</tr></tbody></table>
<div>81 differences found.  Use the toolstrip buttons to navigate to them.</div><div id="diffstart">
<br><pre><div id="ignorediv"><a id="ignorelink"></a></div>
<span class="nodiff" data-left-line="1" data-right-line="1"><a>  1</a> %% RF Indentification Command Line 4 - GUI Ready                                 . %% RF Indentification Command Line 4 - GUI Ready                                 <span><a>  1</a></span></span>
<span class="nodiff" data-left-line="2" data-right-line="2"><a>  2</a> % 04,06,2020 Onwards                                                             . % 04,06,2020 Onwards                                                             <span><a>  2</a></span></span>
<div id="diff0"><span class="diffLine" data-left-line="3" data-right-line="3"><a>  3</a> <span class="diffnomatch">% <span style="background: #be96c6;">Works</span> <span style="background: #be96c6;">with RF_Ident_fn_v4.m</span>                                                    x % <span style="background: #be96c6;">Updated</span> <span style="background: #be96c6;">17,09,2020</span>                                                            </span> <span><a>  3</a></span></span>
<span class="diffLine" data-left-line="4" data-right-line="4"><a>  4</a> <span class="diffnomatch"><span style="background: #be96c6;">function</span> <span style="background: #be96c6;">out</span> <span style="background: #be96c6;">=</span> <span style="background: #be96c6;">RF_Ident_CL_4_GUI_Ready (savepath, add_info)</span>                      x <span style="background: #be96c6;">%</span> <span style="background: #be96c6;">Works</span> <span style="background: #be96c6;">with</span> <span style="background: #be96c6;">RF_Ident_fn_v5.m</span>                                                   </span> <span><a>  4</a></span></span>
<span class="diffLine" data-left-line="5" data-right-line="4"><a>  5</a> <span class="diffnew left">%% Get inputs                                                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="6" data-right-line="4"><a>  6</a> <span class="diffnew left">kernel_settings = add_info.settings.kernel_new;                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="7" data-right-line="4"><a>  7</a> <span class="diffnew left">M = matfile(savepath,'Writable',false);                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="8" data-right-line="4"><a>  8</a> <span class="diffnew left">cell_indices = M.cell_indices;                                                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="9" data-right-line="5"><a>  9</a>                                                                                  .                                                                                  <span><a>  5</a></span></span>
<div id="diff1"><span class="diffLine" data-left-line="9" data-right-line="6"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt; clear all;                                                                      </span> <span><a>  6</a></span></span>
<span class="diffLine" data-left-line="9" data-right-line="7"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt; clc;                                                                            </span> <span><a>  7</a></span></span>
<span class="diffLine" data-left-line="9" data-right-line="8"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                                                                                 </span> <span><a>  8</a></span></span>
</div><span class="nodiff" data-left-line="10" data-right-line="9"><a> 10</a> %% Choose whether to use parallel processing and number of cores                 . %% Choose whether to use parallel processing and number of cores                 <span><a>  9</a></span></span>
<div id="diff2"><span class="diffLine" data-left-line="11" data-right-line="10"><a> 11</a> <span class="diffnomatch">Parpool<span style="background: #be96c6;"> </span>= <span style="background: #be96c6;">add_info.settings.parpro</span>;                                              x Parpool<span style="background: #be96c6;">   </span>= <span style="background: #be96c6;">2</span>;<span style="background: #be96c6;"> % 1: Yes, 2: No.</span>                                                 </span> <span><a> 10</a></span></span>
<span class="diffLine" data-left-line="12" data-right-line="11"><a> 12</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>Num_Cores = <span style="background: #be96c6;">4</span>;                                                                  x Num_Cores = <span style="background: #be96c6;">6</span>;                                                                  </span> <span><a> 11</a></span></span>
</div><span class="nodiff" data-left-line="13" data-right-line="12"><a> 13</a>                                                                                  .                                                                                  <span><a> 12</a></span></span>
<span class="nodiff" data-left-line="14" data-right-line="13"><a> 14</a> %% Make RF Identification Choices                                                . %% Make RF Identification Choices                                                <span><a> 13</a></span></span>
<span class="nodiff" data-left-line="15" data-right-line="14"><a> 15</a>                                                                                  .                                                                                  <span><a> 14</a></span></span>
                                                                       <span class="diffskip">[4 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="20" data-right-line="19"><a> 20</a> % b: LC method (Local Covariance);                                               . % b: LC method (Local Covariance);                                               <span><a> 19</a></span></span>
<span class="nodiff" data-left-line="21" data-right-line="20"><a> 21</a> % c: MI method (Mutual Information).                                             . % c: MI method (Mutual Information).                                             <span><a> 20</a></span></span>
<span class="nodiff" data-left-line="22" data-right-line="21"><a> 22</a> % d: SC method (Self Covariance).                                                . % d: SC method (Self Covariance).                                                <span><a> 21</a></span></span>
<div id="diff3"><span class="diffLine" data-left-line="23" data-right-line="22"><a> 23</a> <span class="diffnomatch">p.RF_Ident_Meth_vec = [<span style="background: #be96c6;">kernel_settings.SS</span>,0,0,<span style="background: #be96c6;">kernel_settings.CI</span>];               x p.RF_Ident_Meth_vec = [<span style="background: #be96c6;">1</span>,0,0,<span style="background: #be96c6;">1</span>];                                                </span> <span><a> 22</a></span></span>
</div><span class="nodiff" data-left-line="24" data-right-line="23"><a> 24</a>                                                                                  .                                                                                  <span><a> 23</a></span></span>
<span class="nodiff" data-left-line="25" data-right-line="24"><a> 25</a> % Choose whether to calculate STE_Full for use with LC/MI/SC % PAR Mod 27,08,202 . % Choose whether to calculate STE_Full for use with LC/MI/SC % PAR Mod 27,08,202 <span><a> 24</a></span></span>
<span class="nodiff" data-left-line="26" data-right-line="25"><a> 26</a> % 1: Yes,                                                                        . % 1: Yes,                                                                        <span><a> 25</a></span></span>
<span class="nodiff" data-left-line="27" data-right-line="26"><a> 27</a> % 2: No.                                                                         . % 2: No.                                                                         <span><a> 26</a></span></span>
<div id="diff4"><span class="diffLine" data-left-line="28" data-right-line="27"><a> 28</a> <span class="diffnomatch">p.STE_Full_Choice = 1;<span style="background: #be96c6;">%2;</span>                                                        x p.STE_Full_Choice = 1;                                                          </span> <span><a> 27</a></span></span>
</div><span class="nodiff" data-left-line="29" data-right-line="28"><a> 29</a>                                                                                  .                                                                                  <span><a> 28</a></span></span>
<span class="nodiff" data-left-line="30" data-right-line="29"><a> 30</a> % Choose RF Quality Control (QC) and Thresholds                                  . % Choose RF Quality Control (QC) and Thresholds                                  <span><a> 29</a></span></span>
<span class="nodiff" data-left-line="31" data-right-line="30"><a> 31</a> if p.RF_Ident_Meth_vec(1) == 1                                                   . if p.RF_Ident_Meth_vec(1) == 1                                                   <span><a> 30</a></span></span>
                                                                       <span class="diffskip">[5 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="37" data-right-line="36"><a> 37</a>                                                                                  .                                                                                  <span><a> 36</a></span></span>
<span class="nodiff" data-left-line="38" data-right-line="37"><a> 38</a>     if p.STA_SD_QC_Type == 1                                                     .     if p.STA_SD_QC_Type == 1                                                     <span><a> 37</a></span></span>
<span class="nodiff" data-left-line="39" data-right-line="38"><a> 39</a>         % Choose SD Threshold                                                    .         % Choose SD Threshold                                                    <span><a> 38</a></span></span>
<div id="diff5"><span class="diffLine" data-left-line="40" data-right-line="39"><a> 40</a> <span class="diffnomatch">        p.STA_SD_Thresh = <span style="background: #be96c6;">kernel_settings.SS_STD</span>; % MEA Data 1 (50px) -- 5 seems x         p.STA_SD_Thresh = <span style="background: #be96c6;">5</span>; % MEA Data 1 (50px) -- 5 seems good.               </span> <span><a> 39</a></span></span>
</div><span class="nodiff" data-left-line="41" data-right-line="40"><a> 41</a>     elseif p.STA_SD_QC_Type == 2                                                 .     elseif p.STA_SD_QC_Type == 2                                                 <span><a> 40</a></span></span>
<span class="nodiff" data-left-line="42" data-right-line="41"><a> 42</a>         % Choose Upper Percentile                                                .         % Choose Upper Percentile                                                <span><a> 41</a></span></span>
<div id="diff6"><span class="diffLine" data-left-line="43" data-right-line="42"><a> 43</a> <span class="diffnomatch">        p.STA_SD_CI_Per = <span style="background: #be96c6;">kernel_settings.SS_CI_Upper</span>; % default: 1 (%)          x         p.STA_SD_CI_Per = <span style="background: #be96c6;">1</span>; % default: 1 (%)                                   </span> <span><a> 42</a></span></span>
</div><span class="nodiff" data-left-line="44" data-right-line="43"><a> 44</a>     end                                                                          .     end                                                                          <span><a> 43</a></span></span>
<span class="nodiff" data-left-line="45" data-right-line="44"><a> 45</a>                                                                                  .                                                                                  <span><a> 44</a></span></span>
<span class="nodiff" data-left-line="46" data-right-line="45"><a> 46</a> end                                                                              . end                                                                              <span><a> 45</a></span></span>
<span class="nodiff" data-left-line="47" data-right-line="46"><a> 47</a>                                                                                  .                                                                                  <span><a> 46</a></span></span>
<div id="diff7"><span class="diffLine" data-left-line="48" data-right-line="47"><a> 48</a> <span class="diffnomatch">if p.RF_Ident_Meth_vec(2)==1<span style="background: #be96c6;"> %Remeains to be implemented @mars</span>                   x if p.RF_Ident_Meth_vec(2)==1                                                    </span> <span><a> 47</a></span></span>
</div><span class="nodiff" data-left-line="49" data-right-line="48"><a> 49</a>                                                                                  .                                                                                  <span><a> 48</a></span></span>
<span class="nodiff" data-left-line="50" data-right-line="49"><a> 50</a>     % Choose LC QC type                                                          .     % Choose LC QC type                                                          <span><a> 49</a></span></span>
<span class="nodiff" data-left-line="51" data-right-line="50"><a> 51</a>     % 1. SD threshold;                                                           .     % 1. SD threshold;                                                           <span><a> 50</a></span></span>
                                                                      <span class="diffskip">[10 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="62" data-right-line="61"><a> 62</a>                                                                                  .                                                                                  <span><a> 61</a></span></span>
<span class="nodiff" data-left-line="63" data-right-line="62"><a> 63</a> end                                                                              . end                                                                              <span><a> 62</a></span></span>
<span class="nodiff" data-left-line="64" data-right-line="63"><a> 64</a>                                                                                  .                                                                                  <span><a> 63</a></span></span>
<div id="diff8"><span class="diffLine" data-left-line="65" data-right-line="64"><a> 65</a> <span class="diffnomatch">if p.RF_Ident_Meth_vec(3)==1<span style="background: #be96c6;"> %Remains to be implemented @mars</span>                    x if p.RF_Ident_Meth_vec(3)==1                                                    </span> <span><a> 64</a></span></span>
</div><span class="nodiff" data-left-line="66" data-right-line="65"><a> 66</a>                                                                                  .                                                                                  <span><a> 65</a></span></span>
<span class="nodiff" data-left-line="67" data-right-line="66"><a> 67</a>     % Choose MI QC type                                                          .     % Choose MI QC type                                                          <span><a> 66</a></span></span>
<span class="nodiff" data-left-line="68" data-right-line="67"><a> 68</a>     % 1. SD threshold;                                                           .     % 1. SD threshold;                                                           <span><a> 67</a></span></span>
                                                                      <span class="diffskip">[19 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="88" data-right-line="87"><a> 88</a>                                                                                  .                                                                                  <span><a> 87</a></span></span>
<span class="nodiff" data-left-line="89" data-right-line="88"><a> 89</a>     if p.SC_QC_Type == 1                                                         .     if p.SC_QC_Type == 1                                                         <span><a> 88</a></span></span>
<span class="nodiff" data-left-line="90" data-right-line="89"><a> 90</a>         % Choose SD Threshold                                                    .         % Choose SD Threshold                                                    <span><a> 89</a></span></span>
<div id="diff9"><span class="diffLine" data-left-line="91" data-right-line="90"><a> 91</a> <span class="diffnomatch">        p.SC_Thresh = <span style="background: #be96c6;">kernel_settings.SC_STD</span>;<span style="background: #be96c6;">  </span>% MEA Data 1 (50px): 7 seems good x         p.SC_Thresh = <span style="background: #be96c6;">7</span>;<span style="background: #be96c6;"> </span>% MEA Data 1 (50px): 7 seems good.                     </span> <span><a> 90</a></span></span>
</div><span class="nodiff" data-left-line="92" data-right-line="91"><a> 92</a>     elseif p.SC_QC_Type == 2                                                     .     elseif p.SC_QC_Type == 2                                                     <span><a> 91</a></span></span>
<span class="nodiff" data-left-line="93" data-right-line="92"><a> 93</a>         % Choose Upper Percentile                                                .         % Choose Upper Percentile                                                <span><a> 92</a></span></span>
<div id="diff10"><span class="diffLine" data-left-line="94" data-right-line="93"><a> 94</a> <span class="diffnomatch">        p.SC_CI_Per = <span style="background: #be96c6;">kernel_settings.SC_CI_Lower</span>; % default: 1 (%)              x         p.SC_CI_Per = <span style="background: #be96c6;">1</span>; % default: 1 (%)                                       </span> <span><a> 93</a></span></span>
</div><span class="nodiff" data-left-line="95" data-right-line="94"><a> 95</a>     end                                                                          .     end                                                                          <span><a> 94</a></span></span>
<span class="nodiff" data-left-line="96" data-right-line="95"><a> 96</a>                                                                                  .                                                                                  <span><a> 95</a></span></span>
<span class="nodiff" data-left-line="97" data-right-line="96"><a> 97</a> end                                                                              . end                                                                              <span><a> 96</a></span></span>
                                                                       <span class="diffskip">[3 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="101" data-right-line="100"><a>101</a> % a. Box;                                                                        . % a. Box;                                                                        <span><a>100</a></span></span>
<span class="nodiff" data-left-line="102" data-right-line="101"><a>102</a> % b. All Significant Pixels;                                                     . % b. All Significant Pixels;                                                     <span><a>101</a></span></span>
<span class="nodiff" data-left-line="103" data-right-line="102"><a>103</a> % c. Gaussian.                                                                   . % c. Gaussian.                                                                   <span><a>102</a></span></span>
<div id="diff11"><span class="diffLine" data-left-line="104" data-right-line="103"><a>104</a> <span class="diffnomatch">p.RF_Type = [<span style="background: #be96c6;">kernel_settings.RF_Box</span>,<span style="background: #be96c6;">kernel_settings.RF_AS</span>,<span style="background: #be96c6;">kernel_settings.RF_Gau</span> x p.RF_Type = [<span style="background: #be96c6;">1</span>,<span style="background: #be96c6;">1</span>,<span style="background: #be96c6;">1</span>];                                                            </span> <span><a>103</a></span></span>
</div><span class="nodiff" data-left-line="105" data-right-line="104"><a>105</a>                                                                                  .                                                                                  <span><a>104</a></span></span>
<span class="nodiff" data-left-line="106" data-right-line="105"><a>106</a> % Choose RF Parameters                                                           . % Choose RF Parameters                                                           <span><a>105</a></span></span>
<span class="nodiff" data-left-line="107" data-right-line="106"><a>107</a> if p.RF_Type(1) == 1   % Box                                                     . if p.RF_Type(1) == 1   % Box                                                     <span><a>106</a></span></span>
<span class="nodiff" data-left-line="108" data-right-line="107"><a>108</a>     % Choose number of rings of pixels around central RF pixel                   .     % Choose number of rings of pixels around central RF pixel                   <span><a>107</a></span></span>
<div id="diff12"><span class="diffLine" data-left-line="109" data-right-line="108"><a>109</a> <span class="diffnomatch">    p.RF_layers = <span style="background: #be96c6;">kernel_settings.RF_RBoxes</span>;                                     x     p.RF_layers = <span style="background: #be96c6;">1</span>;                                                            </span> <span><a>108</a></span></span>
</div><span class="nodiff" data-left-line="110" data-right-line="109"><a>110</a>     % Choose number of rings of pixels around significant Full RF pixels         .     % Choose number of rings of pixels around significant Full RF pixels         <span><a>109</a></span></span>
<div id="diff13"><span class="diffLine" data-left-line="111" data-right-line="110"><a>111</a> <span class="diffnomatch">    p.FullRF_layers = 1;<span style="background: #be96c6;"> %mars: What does this mean?</span>                             x     p.FullRF_layers = 1;                                                        </span> <span><a>110</a></span></span>
</div><span class="nodiff" data-left-line="112" data-right-line="111"><a>112</a> end                                                                              . end                                                                              <span><a>111</a></span></span>
<span class="nodiff" data-left-line="113" data-right-line="112"><a>113</a>                                                                                  .                                                                                  <span><a>112</a></span></span>
<span class="nodiff" data-left-line="114" data-right-line="113"><a>114</a> if p.RF_Type(3) == 1   % Gaussian                                                . if p.RF_Type(3) == 1   % Gaussian                                                <span><a>113</a></span></span>
<span class="nodiff" data-left-line="115" data-right-line="114"><a>115</a>     % Choose number of standard deviations at which to set RF contour            .     % Choose number of standard deviations at which to set RF contour            <span><a>114</a></span></span>
<div id="diff14"><span class="diffLine" data-left-line="116" data-right-line="115"><a>116</a> <span class="diffnomatch">    p.RF_SDs = <span style="background: #be96c6;">kernel_settings.RF_SDGaus</span>; % 2 default                            x     p.RF_SDs = <span style="background: #be96c6;">2</span>; % 2 default                                                   </span> <span><a>115</a></span></span>
</div><span class="nodiff" data-left-line="117" data-right-line="116"><a>117</a> end                                                                              . end                                                                              <span><a>116</a></span></span>
<span class="nodiff" data-left-line="118" data-right-line="117"><a>118</a>                                                                                  .                                                                                  <span><a>117</a></span></span>
<span class="nodiff" data-left-line="119" data-right-line="118"><a>119</a> %% Post RF Calc Options                                                          . %% Post RF Calc Options                                                          <span><a>118</a></span></span>
<span class="nodiff" data-left-line="120" data-right-line="119"><a>120</a>                                                                                  .                                                                                  <span><a>119</a></span></span>
<span class="nodiff" data-left-line="121" data-right-line="120"><a>121</a> % Choose whether to plot RF indentification results                              . % Choose whether to plot RF indentification results                              <span><a>120</a></span></span>
<span class="nodiff" data-left-line="122" data-right-line="121"><a>122</a> % 1. Yes;                                                                        . % 1. Yes;                                                                        <span><a>121</a></span></span>
<span class="nodiff" data-left-line="123" data-right-line="122"><a>123</a> % 2. No.                                                                         . % 2. No.                                                                         <span><a>122</a></span></span>
<div id="diff15"><span class="diffLine" data-left-line="124" data-right-line="123"><a>124</a> <span class="diffnomatch">p.Plot_Choice = <span style="background: #be96c6;">kernel_settings.plot_RF_overview</span>;                                x p.Plot_Choice = <span style="background: #be96c6;">1</span>;                                                              </span> <span><a>123</a></span></span>
</div><span class="nodiff" data-left-line="125" data-right-line="124"><a>125</a>                                                                                  .                                                                                  <span><a>124</a></span></span>
<span class="nodiff" data-left-line="126" data-right-line="125"><a>126</a> %% Make Data Related Choices                                                     . %% Make Data Related Choices                                                     <span><a>125</a></span></span>
<span class="nodiff" data-left-line="127" data-right-line="126"><a>127</a>                                                                                  .                                                                                  <span><a>126</a></span></span>
                                                                      <span class="diffskip">[39 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="167" data-right-line="166"><a>167</a> % 1. Calc from stim frames;                                                      . % 1. Calc from stim frames;                                                      <span><a>166</a></span></span>
<span class="nodiff" data-left-line="168" data-right-line="167"><a>168</a> % 2. Calc from own time grid.                                                    . % 2. Calc from own time grid.                                                    <span><a>167</a></span></span>
<span class="nodiff" data-left-line="169" data-right-line="168"><a>169</a> if p.Time_Choice == 2 &amp;&amp; p.RF_Ident_Meth_vec(2) == 1 &amp;&amp; LocCovar_Choice == 2     . if p.Time_Choice == 2 &amp;&amp; p.RF_Ident_Meth_vec(2) == 1 &amp;&amp; LocCovar_Choice == 2     <span><a>168</a></span></span>
<div id="diff16"><span class="diffLine" data-left-line="170" data-right-line="169"><a>170</a> <span class="diffnomatch">    RawLocCovar_Choice  = 1;<span style="background: #be96c6;"> %@mars This is unused?</span>                              x     RawLocCovar_Choice  = 1;                                                    </span> <span><a>169</a></span></span>
</div><span class="nodiff" data-left-line="171" data-right-line="170"><a>171</a> end                                                                              . end                                                                              <span><a>170</a></span></span>
<span class="nodiff" data-left-line="172" data-right-line="171"><a>172</a>                                                                                  .                                                                                  <span><a>171</a></span></span>
<span class="nodiff" data-left-line="173" data-right-line="172"><a>173</a> % Choose length of time window in which to find the STEs                         . % Choose length of time window in which to find the STEs                         <span><a>172</a></span></span>
                                                                       <span class="diffskip">[3 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="177" data-right-line="176"><a>177</a>                                                                                  .                                                                                  <span><a>176</a></span></span>
<span class="nodiff" data-left-line="178" data-right-line="177"><a>178</a> % Choose stimulus resolution (number of points sampled from stimulus time        . % Choose stimulus resolution (number of points sampled from stimulus time        <span><a>177</a></span></span>
<span class="nodiff" data-left-line="179" data-right-line="178"><a>179</a> % window)                                                                        . % window)                                                                        <span><a>178</a></span></span>
<div id="diff17"><span class="diffLine" data-left-line="180" data-right-line="179"><a>180</a> <span class="diffnomatch">p.Num_STE_bins = <span style="background: #be96c6;">kernel_settings.Num_STE_bins</span>; % Default: 5 (Tom data, Time_Choi x p.Num_STE_bins = <span style="background: #be96c6;">10</span>; % Default: 5 (Tom data, Time_Choice 1) or 10 (Tom data,Time</span> <span><a>179</a></span></span>
</div><span class="nodiff" data-left-line="181" data-right-line="180"><a>181</a>                                                                                  .                                                                                  <span><a>180</a></span></span>
<span class="nodiff" data-left-line="182" data-right-line="181"><a>182</a>                                                                                  .                                                                                  <span><a>181</a></span></span>
<span class="nodiff" data-left-line="183" data-right-line="182"><a>183</a> %% Load Data                                                                     . %% Load Data                                                                     <span><a>182</a></span></span>
<div id="diff18"><span class="diffLine" data-left-line="184" data-right-line="182"><a>184</a> <span class="diffnew left">%mars: I added a new way to load data. It depends on which stimulus the          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="185" data-right-line="182"><a>185</a> <span class="diffnew left">%user selects in the GUI. The spiketimestamps get loaded in batches, to          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="186" data-right-line="182"><a>186</a> <span class="diffnew left">%prevent the memory from overfloating. It calls functions which come with        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="187" data-right-line="182"><a>187</a> <span class="diffnew left">%the GUI and are used in other scripts of the GUI as well.                       &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="188" data-right-line="183"><a>188</a>                                                                                  .                                                                                  <span><a>183</a></span></span>
<div id="diff19"><span class="diffLine" data-left-line="188" data-right-line="184"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt; %load Marvin_Data_Chicken_24_08_2019_PARMod.mat;                                </span> <span><a>184</a></span></span>
<span class="diffLine" data-left-line="188" data-right-line="185"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt; %load Marvin_Data_Chicken_06_12_2019_PARMod.mat;                                </span> <span><a>185</a></span></span>
</div><span class="nodiff" data-left-line="189" data-right-line="186"><a>189</a>                                                                                  .                                                                                  <span><a>186</a></span></span>
<div id="diff20"><span class="diffLine" data-left-line="190" data-right-line="187"><a>190</a> <span class="diffnomatch">%<span style="background: #be96c6;">%</span> <span style="background: #be96c6;">Memory handling  @mars</span>                                                        x %<span style="background: #be96c6;">load</span> <span style="background: #be96c6;">Colour_noise50px_data_PARMod.mat;</span>                                         </span> <span><a>187</a></span></span>
<span class="diffLine" data-left-line="191" data-right-line="188"><a>191</a> <span class="diffnomatch">%<span style="background: #be96c6;">Check</span> <span style="background: #be96c6;">how many spiketimestamps are in recording</span>                                 x %<span style="background: #be96c6;">load</span> <span style="background: #be96c6;">Colour_noise50px_data_PARMod2.mat;</span>                                        </span> <span><a>188</a></span></span>
<span class="diffLine" data-left-line="192" data-right-line="188"><a>192</a> <span class="diffnew left">M = matfile(savepath,'Writable',false); %Using matfile here so we dont have      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="193" data-right-line="188"><a>193</a> <span class="diffnew left">%to load the actual file                                                         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="194" data-right-line="188"><a>194</a> <span class="diffnew left">spikesize = numel(M.spiketimestamps);                                            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="195" data-right-line="188"><a>195</a> <span class="diffnew left">stx_before = size(M.spiketimestamps,2);                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="196" data-right-line="189"><a>196</a>                                                                                  .                                                                                  <span><a>189</a></span></span>
<div id="diff21"><span class="diffLine" data-left-line="197" data-right-line="190"><a>197</a> <span class="diffnomatch"><span style="background: #be96c6;">%Check</span> <span style="background: #be96c6;">how much memory is available</span>                                              x <span style="background: #be96c6;">load</span> <span style="background: #be96c6;">Colour_noise50px_data.mat;</span>                                                 </span> <span><a>190</a></span></span>
<span class="diffLine" data-left-line="198" data-right-line="191"><a>198</a> <span class="diffnomatch">%<span style="background: #be96c6;">One</span> <span style="background: #be96c6;">double</span> <span style="background: #be96c6;">entry</span> is <span style="background: #be96c6;">8</span> <span style="background: #be96c6;">bytes,</span> <span style="background: #be96c6;">we</span> <span style="background: #be96c6;">dont</span> <span style="background: #be96c6;">want</span> <span style="background: #be96c6;">to</span> <span style="background: #be96c6;">use</span> <span style="background: #be96c6;">more</span> <span style="background: #be96c6;">than</span> <span style="background: #be96c6;">one fourth of the</span>    x %<span style="background: #be96c6;">load</span> <span style="background: #be96c6;">30pxNoise_subset.mat;</span> <span style="background: #be96c6;">%</span> <span style="background: #be96c6;">There </span>is <span style="background: #be96c6;">something</span> <span style="background: #be96c6;">wrong</span> <span style="background: #be96c6;">with</span> <span style="background: #be96c6;">this</span> <span style="background: #be96c6;">data</span> <span style="background: #be96c6;">set,</span> <span style="background: #be96c6;">it</span> <span style="background: #be96c6;">gi</span></span> <span><a>191</a></span></span>
<span class="diffLine" data-left-line="199" data-right-line="192"><a>199</a> <span class="diffnomatch">%<span style="background: #be96c6;">available</span> <span style="background: #be96c6;">memory (So that returned data has place as well)</span>                      x %<span style="background: #be96c6;">load</span> <span style="background: #be96c6;">20pxNoise_subset.mat;</span>                                                     </span> <span><a>192</a></span></span>
<span class="diffLine" data-left-line="200" data-right-line="192"><a>200</a> <span class="diffnew left">memory_available = memory;                                                       &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="201" data-right-line="192"><a>201</a> <span class="diffnew left">memory_available = memory_available.MaxPossibleArrayBytes/4;                     &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="202" data-right-line="192"><a>202</a> <span class="diffnew left">array_size_available = memory_available/8;                                       &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="203" data-right-line="193"><a>203</a>                                                                                  .                                                                                  <span><a>193</a></span></span>
<div id="diff22"><span class="diffLine" data-left-line="204" data-right-line="193"><a>204</a> <span class="diffnew left">%Calculate how many batches we need to process all the data. If only one         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="205" data-right-line="193"><a>205</a> <span class="diffnew left">%batch is need, all data will be processed as one set.                           &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="206" data-right-line="193"><a>206</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="207" data-right-line="193"><a>207</a> <span class="diffnew left">%Calculate batch size                                                            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="208" data-right-line="193"><a>208</a> <span class="diffnew left">batch_nr = ceil(spikesize/array_size_available);                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="209" data-right-line="193"><a>209</a> <span class="diffnew left">batch_stx = ceil(stx_before/batch_nr);                                           &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="210" data-right-line="193"><a>210</a> <span class="diffnew left">batch_begins = (1:batch_stx:stx_before);                                         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="211" data-right-line="193"><a>211</a> <span class="diffnew left">batch_ends = batch_begins(2:end)-1;                                              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="212" data-right-line="193"><a>212</a> <span class="diffnew left">batch_ends(end+1) = stx_before;                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="213" data-right-line="193"><a>213</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="214" data-right-line="193"><a>214</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="215" data-right-line="193"><a>215</a> <span class="diffnew left">%% Specifiy trigger channel @mars                                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="216" data-right-line="193"><a>216</a> <span class="diffnew left">%This has to be done only once for all batches, as they are from the same        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="217" data-right-line="193"><a>217</a> <span class="diffnew left">%stimulus normally. I had to swap some of the variable declarations around       &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="218" data-right-line="193"><a>218</a> <span class="diffnew left">%to make them fit to the new loop structure. Trigger channel stuff is            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="219" data-right-line="193"><a>219</a> <span class="diffnew left">%outside the loop, spiketimestamp stuff inside the loop (of batches).            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="220" data-right-line="193"><a>220</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="221" data-right-line="193"><a>221</a> <span class="diffnew left">%mars: Load stim time details                                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="222" data-right-line="193"><a>222</a> <span class="diffnew left">stim_idx = add_info.stim_idx;                                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="223" data-right-line="193"><a>223</a> <span class="diffnew left">stim_begin = add_info.stim_begin;                                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="224" data-right-line="193"><a>224</a> <span class="diffnew left">stim_end = add_info.stim_end;                                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="225" data-right-line="193"><a>225</a> <span class="diffnew left">ch = load(savepath,'-mat','Ch');                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="226" data-right-line="193"><a>226</a> <span class="diffnew left">ch = ch.Ch;                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="227" data-right-line="193"><a>227</a> <span class="diffnew left">Ch01_02 = ch.Ch01_02;                                                            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="228" data-right-line="193"><a>228</a> <span class="diffnew left">SamplingFrequency = ch.SamplingFrequency;                                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="229" data-right-line="193"><a>229</a> <span class="diffnew left">stimulus_nr = numel(stim_begin); %Nr of selected noise stimuli                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="230" data-right-line="193"><a>230</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="231" data-right-line="193"><a>231</a> <span class="diffnew left">for nn = 1:stimulus_nr %Loop over selected stimuli                               &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="232" data-right-line="193"><a>232</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="233" data-right-line="193"><a>233</a> <span class="diffnew left">%% Load Data modified @mars                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="234" data-right-line="193"><a>234</a> <span class="diffnew left">%% Trigger channel for each stimulus                                             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="235" data-right-line="193"><a>235</a> <span class="diffnew left">noise_begin = stim_begin(nn)*SamplingFrequency;                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="236" data-right-line="193"><a>236</a> <span class="diffnew left">noise_end = stim_end(nn)*SamplingFrequency;                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="237" data-right-line="193"><a>237</a> <span class="diffnew left">noise_begin_s = stim_begin(nn);                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="238" data-right-line="193"><a>238</a> <span class="diffnew left">noise_end_s = stim_end(nn);                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="239" data-right-line="193"><a>239</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="240" data-right-line="193"><a>240</a> <span class="diffnew left">%@mars: Cell selection, not sure this should stay in the code                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="241" data-right-line="194"><a>241</a> <span class="diffnomatch"><span style="background: #be96c6;">% </span>if Cell_Choice == 1 % All cells                                                x if Cell_Choice == 1 % All cells                                                 </span> <span><a>194</a></span></span>
<span class="diffLine" data-left-line="242" data-right-line="195"><a>242</a> <span class="diffnomatch"><span style="background: #be96c6;">%     </span>spike_times_mat    = spiketimestamps;                                      x <span style="background: #be96c6;">    </span>spike_times_mat    = spiketimestamps;                                       </span> <span><a>195</a></span></span>
<span class="diffLine" data-left-line="243" data-right-line="196"><a>243</a> <span class="diffnomatch"><span style="background: #be96c6;">%     </span>Cell_Choice_vec    = 1:1:size(spiketimestamps,2);                          x <span style="background: #be96c6;">    </span>Cell_Choice_vec    = 1:1:size(spiketimestamps,2);                           </span> <span><a>196</a></span></span>
<span class="diffLine" data-left-line="244" data-right-line="197"><a>244</a> <span class="diffnomatch"><span style="background: #be96c6;">%     </span>True_cell_index_vec = Cell_Choice_vec(any(~isnan(spike_times_mat)));       x <span style="background: #be96c6;">    </span>True_cell_index_vec = Cell_Choice_vec(any(~isnan(spike_times_mat)));        </span> <span><a>197</a></span></span>
<span class="diffLine" data-left-line="245" data-right-line="198"><a>245</a> <span class="diffnomatch"><span style="background: #be96c6;">% </span>else % Cell_Choice == 2 % Subset of cells                                      x else % Cell_Choice == 2 % Subset of cells                                       </span> <span><a>198</a></span></span>
<span class="diffLine" data-left-line="246" data-right-line="199"><a>246</a> <span class="diffnomatch"><span style="background: #be96c6;">%     </span>spike_times_mat    = spiketimestamps(:,Cell_Choice_vec);                   x <span style="background: #be96c6;">    </span>spike_times_mat    = spiketimestamps(:,Cell_Choice_vec);                    </span> <span><a>199</a></span></span>
<span class="diffLine" data-left-line="247" data-right-line="200"><a>247</a> <span class="diffnomatch">%<span style="background: #be96c6;">     %</span> Remove NaN columns (non-responsive cells)                                x <span style="background: #be96c6;">    </span>% Remove NaN columns (non-responsive cells)                                 </span> <span><a>200</a></span></span>
<span class="diffLine" data-left-line="248" data-right-line="201"><a>248</a> <span class="diffnomatch"><span style="background: #be96c6;">%     </span>True_cell_index_vec = Cell_Choice_vec(any(~isnan(spike_times_mat))); % Rec x <span style="background: #be96c6;">    </span>True_cell_index_vec = Cell_Choice_vec(any(~isnan(spike_times_mat))); % Recor</span> <span><a>201</a></span></span>
<span class="diffLine" data-left-line="249" data-right-line="202"><a>249</a> <span class="diffnomatch"><span style="background: #be96c6;">% </span>end                                                                            x end                                                                             </span> <span><a>202</a></span></span>
</div><span class="nodiff" data-left-line="250" data-right-line="203"><a>250</a>                                                                                  .                                                                                  <span><a>203</a></span></span>
<div id="diff23"><span class="diffLine" data-left-line="251" data-right-line="204"><a>251</a> <span class="diffnomatch"><span style="background: #be96c6;">trigCh_vec</span>(<span style="background: #be96c6;">1,</span>:) = <span style="background: #be96c6;">Ch01_02(noise_begin:noise_end)</span>;<span style="background: #be96c6;"> %This cuts the</span>                 x <span style="background: #be96c6;">spike_times_mat</span>(:<span style="background: #be96c6;">,~any(~isnan(spike_times_mat</span>)<span style="background: #be96c6;">))</span> = <span style="background: #be96c6;">[]</span>;                          </span> <span><a>204</a></span></span>
<span class="diffLine" data-left-line="252" data-right-line="205"><a>252</a> <span class="diffnomatch"><span style="background: #be96c6;">%trigger</span> <span style="background: #be96c6;">trace at stimulus begin and end</span>                                         x <span style="background: #be96c6;">True_Num_Cells     =</span> <span style="background: #be96c6;">size(spike_times_mat,2);</span>                                   </span> <span><a>205</a></span></span>
</div><span class="nodiff" data-left-line="253" data-right-line="206"><a>253</a>                                                                                  .                                                                                  <span><a>206</a></span></span>
<div id="diff24"><span class="diffLine" data-left-line="253" data-right-line="207"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt; trigCh_vec         = Ch_new.trigger_ch;                                         </span> <span><a>207</a></span></span>
</div><span class="nodiff" data-left-line="254" data-right-line="208"><a>254</a> min_trigCh_vec     = min(trigCh_vec);                                            . min_trigCh_vec     = min(trigCh_vec);                                            <span><a>208</a></span></span>
<span class="nodiff" data-left-line="255" data-right-line="209"><a>255</a> max_trigCh_vec     = max(trigCh_vec);                                            . max_trigCh_vec     = max(trigCh_vec);                                            <span><a>209</a></span></span>
<span class="nodiff" data-left-line="256" data-right-line="210"><a>256</a> trigThreshFac      = 0.05; % 0.1                                                 . trigThreshFac      = 0.05; % 0.1                                                 <span><a>210</a></span></span>
<span class="nodiff" data-left-line="257" data-right-line="211"><a>257</a> trigHigh_vec       = double(trigCh_vec &gt; min_trigCh_vec + trigThreshFac*(max_tri . trigHigh_vec       = double(trigCh_vec &gt; min_trigCh_vec + trigThreshFac*(max_tri <span><a>211</a></span></span>
<div id="diff25"><span class="diffLine" data-left-line="258" data-right-line="212"><a>258</a> <span class="diffnomatch">[~,<span style="background: #be96c6;">trig_index_vec_temp</span>] = findpeaks(trigHigh_vec);% 'MinPeakProminence',#,'MinPe x [~,<span style="background: #be96c6;">trig_index_vec</span>] = findpeaks(trigHigh_vec);<span style="background: #be96c6;"> </span>% 'MinPeakProminence',#,'MinPeakDi</span> <span><a>212</a></span></span>
<span class="diffLine" data-left-line="259" data-right-line="213"><a>259</a> <span class="diffnomatch"><span style="background: #be96c6;">trig_index_vec = zeros(1,size(trig_index_vec_temp,2)+1);</span>                         x                                                                                 </span> <span><a>213</a></span></span>
<span class="diffLine" data-left-line="260" data-right-line="214"><a>260</a> <span class="diffnomatch"><span style="background: #be96c6;">trig_index_vec(1,1) </span>= <span style="background: #be96c6;">1</span>;                                                         x <span style="background: #be96c6;">sampling_freq      </span>= <span style="background: #be96c6;">Ch_new.SamplingFrequency</span>;                                  </span> <span><a>214</a></span></span>
<span class="diffLine" data-left-line="261" data-right-line="214"><a>261</a> <span class="diffnew left">trig_index_vec(1,2:end) = trig_index_vec_temp;                                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="262" data-right-line="214"><a>262</a> <span class="diffnew left">%trig_index_vec(1,end) = size(trigHigh_vec,2);                                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="263" data-right-line="214"><a>263</a> <span class="diffnew left">sampling_freq      = SamplingFrequency;                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="264" data-right-line="215"><a>264</a> sampling_int       = 1/sampling_freq;                                            . sampling_int       = 1/sampling_freq;                                            <span><a>215</a></span></span>
<span class="nodiff" data-left-line="265" data-right-line="216"><a>265</a>                                                                                  .                                                                                  <span><a>216</a></span></span>
<span class="nodiff" data-left-line="266" data-right-line="217"><a>266</a> trig_times_vec_temp = (trig_index_vec-1)*sampling_int;                           . trig_times_vec_temp = (trig_index_vec-1)*sampling_int;                           <span><a>217</a></span></span>
<span class="nodiff" data-left-line="267" data-right-line="218"><a>267</a> % I take it that the rising edge starts at the timepoint directly                . % I take it that the rising edge starts at the timepoint directly                <span><a>218</a></span></span>
<span class="nodiff" data-left-line="268" data-right-line="219"><a>268</a> % before the jump upwards - hence '(trig_index_vec-1)' rather than 'trig_index_v . % before the jump upwards - hence '(trig_index_vec-1)' rather than 'trig_index_v <span><a>219</a></span></span>
<span class="nodiff" data-left-line="269" data-right-line="220"><a>269</a> trig_times_vec      = trig_times_vec_temp - trig_times_vec_temp(1); % set first  . trig_times_vec      = trig_times_vec_temp - trig_times_vec_temp(1); % set first  <span><a>220</a></span></span>
<div id="diff26"><span class="diffLine" data-left-line="270" data-right-line="220"><a>270</a> <span class="diffnew left">%@mars: this somehow didnt work correctly, the first trigger is at time          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="271" data-right-line="220"><a>271</a> <span class="diffnew left">%0, so it must be (1) in trig_times_vec.                                         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="272" data-right-line="221"><a>272</a>                                                                                  .                                                                                  <span><a>221</a></span></span>
<div id="diff27"><span class="diffLine" data-left-line="273" data-right-line="222"><a>273</a> <span class="diffnomatch">%<span style="background: #be96c6;">%</span> <span style="background: #be96c6;">Check</span> <span style="background: #be96c6;">for</span> <span style="background: #be96c6;">frozen</span> <span style="background: #be96c6;">repeats</span> <span style="background: #be96c6;">@mars</span>                                                x <span style="background: #be96c6;">clear spiketimestamps Ch_new; </span>% <span style="background: #be96c6;">Remove</span> <span style="background: #be96c6;">original</span> <span style="background: #be96c6;">data</span> <span style="background: #be96c6;">files</span> <span style="background: #be96c6;">as no longer needed.</span> </span> <span><a>222</a></span></span>
<span class="diffLine" data-left-line="274" data-right-line="222"><a>274</a> <span class="diffnew left">%@mars: We need to find out how often the stimulus sequence was repeated.        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="275" data-right-line="222"><a>275</a> <span class="diffnew left">trig_times_diff = ceil05(diff(trig_times_vec),0.05); %@mars: find beginning and  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="276" data-right-line="222"><a>276</a> <span class="diffnew left">%end of noise repeats                                                            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="277" data-right-line="222"><a>277</a> <span class="diffnew left">noise_begins = trig_times_diff &gt; 5*mean(trig_times_diff);                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="278" data-right-line="222"><a>278</a> <span class="diffnew left">nr_frozen = nnz(noise_begins)+1;%@mars: +1 because diff finds the difference     &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="279" data-right-line="222"><a>279</a> <span class="diffnew left">noise_begins_idx = ones(1,nr_frozen);                                            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="280" data-right-line="222"><a>280</a> <span class="diffnew left">noise_begins_idx(2:end) = find(noise_begins); %@mars: index in trig_index_vec_te &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="281" data-right-line="222"><a>281</a> <span class="diffnew left">p.noise_begins_idx = noise_begins_idx;                                           &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="282" data-right-line="222"><a>282</a> <span class="diffnew left">% of the begining of each frozen noise repeat                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="283" data-right-line="223"><a>283</a>                                                                                  .                                                                                  <span><a>223</a></span></span>
<div id="diff28"><span class="diffLine" data-left-line="283" data-right-line="224"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt; % Check that triggers are correctly identified.                                 </span> <span><a>224</a></span></span>
<span class="diffLine" data-left-line="283" data-right-line="225"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt; % figure; plot(trigCh_vec); hold on;                                            </span> <span><a>225</a></span></span>
<span class="diffLine" data-left-line="283" data-right-line="226"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt; % plot(trig_index_vec,4085*ones(1,length(trig_index_vec)),'ro');                </span> <span><a>226</a></span></span>
</div><span class="nodiff" data-left-line="284" data-right-line="227"><a>284</a>                                                                                  .                                                                                  <span><a>227</a></span></span>
<div id="diff29"><span class="diffLine" data-left-line="285" data-right-line="228"><a>285</a> <span class="diffnomatch"><span style="background: #be96c6;">if</span> <span style="background: #be96c6;">nr_frozen</span> <span style="background: #be96c6;">&gt; 1</span>                                                                 x <span style="background: #be96c6;">stimulus_arr(:,:,1)</span> <span style="background: #be96c6;">=</span> <span style="background: #be96c6;">importdata('Red_Noise.txt',',')';</span>                         </span> <span><a>228</a></span></span>
<span class="diffLine" data-left-line="286" data-right-line="229"><a>286</a> <span class="diffnomatch"><span style="background: #be96c6;">    %Check</span> <span style="background: #be96c6;">if</span> <span style="background: #be96c6;">the last repeat of the noise is complete</span>                           x <span style="background: #be96c6;">stimulus_arr(:,:,2)</span> <span style="background: #be96c6;">=</span> <span style="background: #be96c6;">importdata('Green_Noise.txt',',')';</span>                       </span> <span><a>229</a></span></span>
<span class="diffLine" data-left-line="287" data-right-line="230"><a>287</a> <span class="diffnomatch"><span style="background: #be96c6;">    nr_trig_first_repeat</span> = <span style="background: #be96c6;">noise_begins_idx</span>(<span style="background: #be96c6;">2</span>);                                  x <span style="background: #be96c6;">stimulus_arr(:,:,3)</span> = <span style="background: #be96c6;">importdata</span>(<span style="background: #be96c6;">'Blue_Noise.txt',','</span>)<span style="background: #be96c6;">'</span>;                        </span> <span><a>230</a></span></span>
<span class="diffLine" data-left-line="288" data-right-line="231"><a>288</a> <span class="diffnomatch"><span style="background: #be96c6;">    nr_trig_last_repeat</span> = <span style="background: #be96c6;">length</span>(<span style="background: #be96c6;">trig_index_vec</span>)<span style="background: #be96c6;">-noise_begins_idx(end)-1</span>;        x <span style="background: #be96c6;">stimulus_arr(:,:,4)</span> = <span style="background: #be96c6;">importdata</span>(<span style="background: #be96c6;">'UV_Noise.txt',','</span>)<span style="background: #be96c6;">'</span>;                          </span> <span><a>231</a></span></span>
<span class="diffLine" data-left-line="288" data-right-line="232"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt; stimulus_arr(:,1,:) = []; % stimulus_arr(1,:,:) before transposed above         </span> <span><a>232</a></span></span>
<span class="diffLine" data-left-line="288" data-right-line="233"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt; stimulus_arr        = reshape(stimulus_arr,[40,40,6000,4]);                     </span> <span><a>233</a></span></span>
<span class="diffLine" data-left-line="289" data-right-line="234"><a>289</a> <span class="diffnomatch"><span style="background: #be96c6;">    </span>                                                                             x                                                                                 </span> <span><a>234</a></span></span>
<span class="diffLine" data-left-line="290" data-right-line="235"><a>290</a> <span class="diffnomatch"><span style="background: #be96c6;">    if</span> <span style="background: #be96c6;">nr_trig_first_repeat </span>=<span style="background: #be96c6;">=</span> <span style="background: #be96c6;">nr_trig_last_repeat</span>                               x <span style="background: #be96c6;">p.Spectral_Dim</span> = <span style="background: #be96c6;">size(stimulus_arr,4);</span>                                          </span> <span><a>235</a></span></span>
<span class="diffLine" data-left-line="291" data-right-line="235"><a>291</a> <span class="diffnew left">        trig_per_frozen = int64(numel(trig_times_vec)/nr_frozen);                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="292" data-right-line="235"><a>292</a> <span class="diffnew left">    else %@mars: Only possibility is that the last repeat is shorter             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="293" data-right-line="235"><a>293</a> <span class="diffnew left">        trig_per_frozen = int64(noise_begins_idx(2));                            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="294" data-right-line="235"><a>294</a> <span class="diffnew left">    end                                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="295" data-right-line="236"><a>295</a> <span class="diffnomatch"><span style="background: #be96c6;">                </span>                                                                 x                                                                                 </span> <span><a>236</a></span></span>
<span class="diffLine" data-left-line="296" data-right-line="237"><a>296</a> <span class="diffnomatch"><span style="background: #be96c6;">else </span>%<span style="background: #be96c6;">If</span> <span style="background: #be96c6;">effectively</span> <span style="background: #be96c6;">no</span> <span style="background: #be96c6;">frozen</span> <span style="background: #be96c6;">noise is played but only on sequence</span>              x % <span style="background: #be96c6;">if</span> <span style="background: #be96c6;">size(stimulus_arr,3)</span> <span style="background: #be96c6;">~=</span> <span style="background: #be96c6;">length(trig_times_vec)</span>                             </span> <span><a>237</a></span></span>
<span class="diffLine" data-left-line="297" data-right-line="238"><a>297</a> <span class="diffnomatch"><span style="background: #be96c6;">    trig_per_frozen</span> <span style="background: #be96c6;">=</span> <span style="background: #be96c6;">length(trig_times_vec</span>);                                    x <span style="background: #be96c6;">%     disp('NB:</span> <span style="background: #be96c6;">There</span> <span style="background: #be96c6;">is a mismatch between the number of stimulus frames and th</span></span> <span><a>238</a></span></span>
<span class="diffLine" data-left-line="298" data-right-line="238"><a>298</a> <span class="diffnew left">    warning('No noise repeats detected, assuming only 1 noise sequence and no fr &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="299" data-right-line="238"><a>299</a> <span class="diffnew left">    nr_trig_last_repeat = 0;                                                     &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="300" data-right-line="239"><a>300</a> <span class="diffnomatch">end                                                                              x <span style="background: #be96c6;">% </span>end                                                                           </span> <span><a>239</a></span></span>
<span class="diffLine" data-left-line="301" data-right-line="239"><a>301</a> <span class="diffnew left">p.Gap_Ind = 2;                                                                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="302" data-right-line="240"><a>302</a> <span class="diffnomatch"><span style="background: #be96c6;">    </span>                                                                             x                                                                                 </span> <span><a>240</a></span></span>
<span class="diffLine" data-left-line="303" data-right-line="241"><a>303</a> <span class="diffnomatch"><span style="background: #be96c6;">%@mars:</span> <span style="background: #be96c6;">Now</span> <span style="background: #be96c6;">we</span> <span style="background: #be96c6;">can</span> <span style="background: #be96c6;">load</span> <span style="background: #be96c6;">the</span> <span style="background: #be96c6;">sequence</span> <span style="background: #be96c6;">according</span> <span style="background: #be96c6;">to</span> <span style="background: #be96c6;">what </span>was <span style="background: #be96c6;">played</span>                x <span style="background: #be96c6;">p.stim_frames</span> <span style="background: #be96c6;">=</span> <span style="background: #be96c6;">size(stimulus_arr,3);   %</span> <span style="background: #be96c6;">PAR</span> <span style="background: #be96c6;">Mod</span> <span style="background: #be96c6;">27,08,2020</span> <span style="background: #be96c6;">(moved</span> <span style="background: #be96c6;">from</span> <span style="background: #be96c6;">below,</span> </span> <span><a>241</a></span></span>
<span class="diffLine" data-left-line="304" data-right-line="241"><a>304</a> <span class="diffnew left">%@mars: Need to add part that deals with case of no gaps between noise           &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="305" data-right-line="241"><a>305</a> <span class="diffnew left">%chunks                                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="306" data-right-line="241"><a>306</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="307" data-right-line="241"><a>307</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="308" data-right-line="241"><a>308</a> <span class="diffnew left">p.stim_frames = double(trig_per_frozen);   % PAR Mod 27,08,2020 (moved from belo &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="309" data-right-line="242"><a>309</a> p.Num_trigs   = length(trig_times_vec); % PAR Mod 27,08,2020                     . p.Num_trigs   = length(trig_times_vec); % PAR Mod 27,08,2020                     <span><a>242</a></span></span>
<div id="diff30"><span class="diffLine" data-left-line="309" data-right-line="243"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                                                                                 </span> <span><a>243</a></span></span>
<span class="diffLine" data-left-line="310" data-right-line="244"><a>310</a> <span class="diffnomatch"><span style="background: #be96c6;">%</span>if p.Num_trigs &gt; p.stim_frames % Frozen noise repeated case % PAR Mod 27,08,202 x if p.Num_trigs &gt; p.stim_frames % Frozen noise repeated case % PAR Mod 27,08,2020</span> <span><a>244</a></span></span>
<span class="diffLine" data-left-line="311" data-right-line="245"><a>311</a> <span class="diffnomatch">                                                                                 x <span style="background: #be96c6;">    </span>                                                                            </span> <span><a>245</a></span></span>
<span class="diffLine" data-left-line="312" data-right-line="246"><a>312</a> <span class="diffnomatch">                                                                                 x <span style="background: #be96c6;">    Num_FNoise_rep      = p.Num_trigs/p.stim_frames;</span>                            </span> <span><a>246</a></span></span>
<span class="diffLine" data-left-line="313" data-right-line="246"><a>313</a> <span class="diffnew left">Num_FNoise_rep      = nr_frozen;                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="314" data-right-line="247"><a>314</a> <span class="diffnomatch">p.Num_FNoise_rep_ceil = ceil(Num_FNoise_rep);                                    x <span style="background: #be96c6;">    </span>p.Num_FNoise_rep_ceil = ceil(Num_FNoise_rep);                               </span> <span><a>247</a></span></span>
<span class="diffLine" data-left-line="315" data-right-line="248"><a>315</a> <span class="diffnomatch">max_trig_int        = max(diff(trig_times_vec(1:p.stim_frames)));                x <span style="background: #be96c6;">    </span>max_trig_int        = max(diff(trig_times_vec(1:p.stim_frames)));           </span> <span><a>248</a></span></span>
<span class="diffLine" data-left-line="316" data-right-line="249"><a>316</a> <span class="diffnomatch">inter_noise_int_vec = NaN(p.Num_FNoise_rep_ceil-1,1);                            x <span style="background: #be96c6;">    </span>inter_noise_int_vec = NaN(p.Num_FNoise_rep_ceil-1,1);                       </span> <span><a>249</a></span></span>
<span class="diffLine" data-left-line="317" data-right-line="250"><a>317</a> <span class="diffnomatch">for i = 1:p.Num_FNoise_rep_ceil-1                                                x <span style="background: #be96c6;">    </span>for i = 1:p.Num_FNoise_rep_ceil-1                                           </span> <span><a>250</a></span></span>
<span class="diffLine" data-left-line="318" data-right-line="251"><a>318</a> <span class="diffnomatch"><span style="background: #be96c6;">    </span>inter_noise_int_vec(i) = trig_times_vec(i*p.stim_frames+1)-trig_times_vec(i* x <span style="background: #be96c6;">        </span>inter_noise_int_vec(i) = trig_times_vec(i*p.stim_frames+1)-trig_times_ve</span> <span><a>251</a></span></span>
<span class="diffLine" data-left-line="319" data-right-line="252"><a>319</a> <span class="diffnomatch">end                                                                              x <span style="background: #be96c6;">    </span>end                                                                         </span> <span><a>252</a></span></span>
<span class="diffLine" data-left-line="320" data-right-line="253"><a>320</a> <span class="diffnomatch">                                                                                 x <span style="background: #be96c6;">    </span>                                                                            </span> <span><a>253</a></span></span>
<span class="diffLine" data-left-line="321" data-right-line="254"><a>321</a> <span class="diffnomatch">%% <span style="background: #be96c6;">Noise</span> <span style="background: #be96c6;">sequence</span> <span style="background: #be96c6;">for</span> <span style="background: #be96c6;">each</span> <span style="background: #be96c6;">stimulus</span> <span style="background: #be96c6;">@mars</span>                                        x <span style="background: #be96c6;">    </span>%<span style="background: #be96c6;"> Define variable to note if we are in the gaps or w/o gaps case </span>% <span style="background: #be96c6;">PAR</span> <span style="background: #be96c6;">Mod</span> <span style="background: #be96c6;">1</span></span> <span><a>254</a></span></span>
<span class="diffLine" data-left-line="322" data-right-line="255"><a>322</a> <span class="diffnomatch">%<span style="background: #be96c6;">Noise</span> <span style="background: #be96c6;">sequence</span> <span style="background: #be96c6;">is</span> <span style="background: #be96c6;">either loaded from HDF5 file or text file</span>                     x <span style="background: #be96c6;">    </span>% <span style="background: #be96c6;">1.</span> <span style="background: #be96c6;">w/o</span> <span style="background: #be96c6;">gaps;</span>                                                              </span> <span><a>255</a></span></span>
<span class="diffLine" data-left-line="323" data-right-line="256"><a>323</a> <span class="diffnomatch"><span style="background: #be96c6;">noise_file</span> <span style="background: #be96c6;">=</span> <span style="background: #be96c6;">add_info</span>.<span style="background: #be96c6;">settings.location.noise;</span>                                   x <span style="background: #be96c6;">    %</span> <span style="background: #be96c6;">2.</span> <span style="background: #be96c6;">with gaps</span>.                                                             </span> <span><a>256</a></span></span>
<span class="diffLine" data-left-line="324" data-right-line="257"><a>324</a> <span class="diffnomatch"><span style="background: #be96c6;">%Check</span> <span style="background: #be96c6;">for</span> <span style="background: #be96c6;">file</span> <span style="background: #be96c6;">ending</span>                                                           x <span style="background: #be96c6;">    if</span> <span style="background: #be96c6;">sum(inter_noise_int_vec</span> <span style="background: #be96c6;">&lt;=</span> <span style="background: #be96c6;">max_trig_int)</span> <span style="background: #be96c6;">== p.Num_FNoise_rep_ceil-1</span>      </span> <span><a>257</a></span></span>
<span class="diffLine" data-left-line="325" data-right-line="258"><a>325</a> <span class="diffnomatch"><span style="background: #be96c6;">file_ending</span> = <span style="background: #be96c6;">get_fileformat(noise_file)</span>;                                        x <span style="background: #be96c6;">        p.Gap_Ind</span> = <span style="background: #be96c6;">1</span>;                                                          </span> <span><a>258</a></span></span>
<span class="diffLine" data-left-line="326" data-right-line="259"><a>326</a> <span class="diffnomatch">                                                                                 x <span style="background: #be96c6;">    else % sum(inter_noise_int_vec &lt;= max_trig_int) &lt; p.Num_FNoise_rep_ceil-1 (a</span></span> <span><a>259</a></span></span>
<span class="diffLine" data-left-line="327" data-right-line="260"><a>327</a> <span class="diffnomatch"><span style="background: #be96c6;">if strcmp(file_ending,'</span>.<span style="background: #be96c6;">h5')</span>                                                     x <span style="background: #be96c6;">        p</span>.<span style="background: #be96c6;">Gap_Ind = 2;</span>                                                          </span> <span><a>260</a></span></span>
<span class="diffLine" data-left-line="328" data-right-line="260"><a>328</a> <span class="diffnew left">stimulus_arr = load_noise_from_hdf5(string(noise_file),true,1,double(trig_per_fr &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="329" data-right-line="260"><a>329</a> <span class="diffnew left">nr_boxes = int64(sqrt(size(stimulus_arr,2)));                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="330" data-right-line="260"><a>330</a> <span class="diffnew left">nr_colours = int64(size(stimulus_arr,3));                                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="331" data-right-line="260"><a>331</a> <span class="diffnew left">stimulus_arr = reshape(stimulus_arr,[nr_boxes,nr_boxes,trig_per_frozen,nr_colour &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="332" data-right-line="260"><a>332</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="333" data-right-line="260"><a>333</a> <span class="diffnew left">elseif strcmp(file_ending,'.txt') %Old version of getting the sequence           &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="334" data-right-line="260"><a>334</a> <span class="diffnew left">%Get folder location                                                             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="335" data-right-line="260"><a>335</a> <span class="diffnew left">folder_ending = max(strfind(noise_file,'\'));                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="336" data-right-line="260"><a>336</a> <span class="diffnew left">folder_dir = noise_file(1:folder_ending);                                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="337" data-right-line="260"><a>337</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="338" data-right-line="260"><a>338</a> <span class="diffnew left">stimulus_arr(:,:,1) = importdata([folder_dir,'Red_Noise.txt'],',')';             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="339" data-right-line="260"><a>339</a> <span class="diffnew left">stimulus_arr(:,:,2) = importdata([folder_dir,'Green_Noise.txt'],',')';           &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="340" data-right-line="260"><a>340</a> <span class="diffnew left">stimulus_arr(:,:,3) = importdata([folder_dir,'Blue_Noise.txt'],',')';            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="341" data-right-line="260"><a>341</a> <span class="diffnew left">stimulus_arr(:,:,4) = importdata([folder_dir,'UV_Noise.txt'],',')';              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="342" data-right-line="260"><a>342</a> <span class="diffnew left">stimulus_arr(:,1,:) = []; % stimulus_arr(1,:,:) before transposed above          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="343" data-right-line="260"><a>343</a> <span class="diffnew left">stimulus_arr        = reshape(stimulus_arr,[40,40,6000,4]);                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="344" data-right-line="260"><a>344</a> <span class="diffnew left">nr_colours = 4;                                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="345" data-right-line="261"><a>345</a> <span class="diffnomatch">end                                                                              x <span style="background: #be96c6;">    </span>end                                                                         </span> <span><a>261</a></span></span>
<span class="diffLine" data-left-line="346" data-right-line="262"><a>346</a> <span class="diffnomatch">                                                                                 x <span style="background: #be96c6;">    </span>                                                                            </span> <span><a>262</a></span></span>
<span class="diffLine" data-left-line="347" data-right-line="263"><a>347</a> <span class="diffnomatch">p.<span style="background: #be96c6;">Spectral_Dim</span> = <span style="background: #be96c6;">nr_colours;</span>                                                     x <span style="background: #be96c6;">else % </span>p.<span style="background: #be96c6;">Num_trigs</span> <span style="background: #be96c6;">&lt;</span>= <span style="background: #be96c6;">p.stim_frames % PAR Mod 17,09,2020 (else part)</span>            </span> <span><a>263</a></span></span>
<span class="diffLine" data-left-line="348" data-right-line="264"><a>348</a> <span class="diffnomatch">                                                                                 x <span style="background: #be96c6;">    </span>                                                                            </span> <span><a>264</a></span></span>
<span class="diffLine" data-left-line="349" data-right-line="265"><a>349</a> <span class="diffnomatch"><span style="background: #be96c6;">fprintf(['Loaded</span> <span style="background: #be96c6;">',</span> <span style="background: #be96c6;">num2str(trig_per_frozen),'</span> <span style="background: #be96c6;">frames</span> <span style="background: #be96c6;">from</span> <span style="background: #be96c6;">noise</span> <span style="background: #be96c6;">file']);</span>        x <span style="background: #be96c6;">    p.Gap_Ind</span> <span style="background: #be96c6;">=</span> <span style="background: #be96c6;">2;</span> <span style="background: #be96c6;">%</span> <span style="background: #be96c6;">If</span> <span style="background: #be96c6;">there</span> <span style="background: #be96c6;">are no repeats then treat as if there are gaps</span>    </span> <span><a>265</a></span></span>
<span class="diffLine" data-left-line="350" data-right-line="266"><a>350</a> <span class="diffnomatch">                                                                                 x <span style="background: #be96c6;">    </span>                                                                            </span> <span><a>266</a></span></span>
<span class="diffLine" data-left-line="351" data-right-line="266"><a>351</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="352" data-right-line="266"><a>352</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="353" data-right-line="266"><a>353</a> <span class="diffnew left">%% Old stimulus loading                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="354" data-right-line="266"><a>354</a> <span class="diffnew left">% % Check that triggers are correctly identified.                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="355" data-right-line="266"><a>355</a> <span class="diffnew left">% %figure; plot(trigCh_vec); hold on;                                            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="356" data-right-line="266"><a>356</a> <span class="diffnew left">% %plot(trig_index_vec,4085*ones(1,length(trig_index_vec)),'ro');                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="357" data-right-line="266"><a>357</a> <span class="diffnew left">%                                                                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="358" data-right-line="266"><a>358</a> <span class="diffnew left">% stimulus_arr(:,:,1) = importdata('Red_Noise.txt',',')';                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="359" data-right-line="266"><a>359</a> <span class="diffnew left">% stimulus_arr(:,:,2) = importdata('Green_Noise.txt',',')';                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="360" data-right-line="266"><a>360</a> <span class="diffnew left">% stimulus_arr(:,:,3) = importdata('Blue_Noise.txt',',')';                       &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="361" data-right-line="266"><a>361</a> <span class="diffnew left">% stimulus_arr(:,:,4) = importdata('UV_Noise.txt',',')';                         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="362" data-right-line="266"><a>362</a> <span class="diffnew left">% stimulus_arr(:,1,:) = []; % stimulus_arr(1,:,:) before transposed above        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="363" data-right-line="266"><a>363</a> <span class="diffnew left">% stimulus_arr        = reshape(stimulus_arr,[40,40,6000,4]);                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="364" data-right-line="266"><a>364</a> <span class="diffnew left">%                                                                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="365" data-right-line="266"><a>365</a> <span class="diffnew left">% p.Spectral_Dim = size(stimulus_arr,4);                                         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="366" data-right-line="266"><a>366</a> <span class="diffnew left">%                                                                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="367" data-right-line="266"><a>367</a> <span class="diffnew left">% % if size(stimulus_arr,3) ~= length(trig_times_vec)                            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="368" data-right-line="266"><a>368</a> <span class="diffnew left">% %     disp('NB: There is a mismatch between the number of stimulus frames and  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="369" data-right-line="267"><a>369</a> <span class="diffnomatch"><span style="background: #be96c6;">% % </span>end                                                                          x end                                                                             </span> <span><a>267</a></span></span>
<span class="diffLine" data-left-line="370" data-right-line="267"><a>370</a> <span class="diffnew left">%                                                                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="371" data-right-line="267"><a>371</a> <span class="diffnew left">%                                                                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="372" data-right-line="267"><a>372</a> <span class="diffnew left">% % p.stim_frames = size(stimulus_arr,3);   % PAR Mod 27,08,2020 (moved from bel &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="373" data-right-line="267"><a>373</a> <span class="diffnew left">% % p.Num_trigs   = length(trig_times_vec); % PAR Mod 27,08,2020                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="374" data-right-line="267"><a>374</a> <span class="diffnew left">% %@mars: This will not work and is kind of circular. How do we know how many    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="375" data-right-line="267"><a>375</a> <span class="diffnew left">% %stim frames we need to load? Only based on the stimulus channel, but than     &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="376" data-right-line="267"><a>376</a> <span class="diffnew left">% %we can never have more trigger signals than frames by definition.             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="377" data-right-line="268"><a>377</a>                                                                                  .                                                                                  <span><a>268</a></span></span>
<div id="diff31"><span class="diffLine" data-left-line="378" data-right-line="269"><a>378</a> <span class="diffnomatch">%<span style="background: #be96c6;">%</span>                                                                               x <span style="background: #be96c6;">p.noise_length       = min(p.Num_trigs,p.stim_frames); </span>%<span style="background: #be96c6;"> PAR Mod 17,09,2020 (noi</span></span> <span><a>269</a></span></span>
<span class="diffLine" data-left-line="378" data-right-line="270"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt; trig_times_vec_trunc = trig_times_vec(1:p.noise_length); % PAR Mod 17,09,2020 (n</span> <span><a>270</a></span></span>
</div><span class="nodiff" data-left-line="379" data-right-line="271"><a>379</a>                                                                                  .                                                                                  <span><a>271</a></span></span>
<div id="diff32"><span class="diffLine" data-left-line="379" data-right-line="272"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt; Num_Trig_Final_NoiseChunk = mod(p.Num_trigs,p.stim_frames); % PAR Mod 17,09,2020</span> <span><a>272</a></span></span>
</div><span class="nodiff" data-left-line="380" data-right-line="273"><a>380</a>                                                                                  .                                                                                  <span><a>273</a></span></span>
<div id="diff33"><span class="diffLine" data-left-line="381" data-right-line="273"><a>381</a> <span class="diffnew left">p.noise_length         = min(p.Num_trigs,p.stim_frames); % PAR Mod 27,08,2020 Do &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="382" data-right-line="273"><a>382</a> <span class="diffnew left">%@mars: Not sure, what noise_length is supposed to be!? Is this the length       &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="383" data-right-line="273"><a>383</a> <span class="diffnew left">%of one noise repeat?                                                            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="384" data-right-line="273"><a>384</a> <span class="diffnew left">trig_times_vec_trunc = trig_times_vec(1:p.noise_length); % PAR Mod 27,08,2020 (t &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="385" data-right-line="273"><a>385</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="386" data-right-line="274"><a>386</a> %%% Set Parameters                                                               . %%% Set Parameters                                                               <span><a>274</a></span></span>
<span class="nodiff" data-left-line="387" data-right-line="275"><a>387</a>                                                                                  .                                                                                  <span><a>275</a></span></span>
<span class="nodiff" data-left-line="388" data-right-line="276"><a>388</a> % Stimulus ppties                                                                . % Stimulus ppties                                                                <span><a>276</a></span></span>
<div id="diff34"><span class="diffLine" data-left-line="389" data-right-line="277"><a>389</a> <span class="diffnomatch"><span style="background: #be96c6;">% </span>stim_freq<span style="background: #be96c6;"> </span>= 20;<span style="background: #be96c6;">        </span>% Hz<span style="background: #be96c6;"> @mars: This should be defined programatically and </span> x stim_freq<span style="background: #be96c6;">  </span>= 20;<span style="background: #be96c6;">          </span>% Hz                                                  </span> <span><a>277</a></span></span>
<span class="diffLine" data-left-line="390" data-right-line="277"><a>390</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="391" data-right-line="277"><a>391</a> <span class="diffnew left">stim_freq_check = 1/ceil05(nanmean(diff(trig_times_vec(1:p.noise_length))),0.05) &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="392" data-right-line="277"><a>392</a> <span class="diffnew left">%there are too many outliers we might want to ask the user...                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="393" data-right-line="277"><a>393</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="394" data-right-line="277"><a>394</a> <span class="diffnew left">%Compare calculated frequency to the user input and through error if they        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="395" data-right-line="277"><a>395</a> <span class="diffnew left">%dont match                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="396" data-right-line="277"><a>396</a> <span class="diffnew left">stim_freq = add_info.settings.kernel_new.Hz;                                     &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="397" data-right-line="277"><a>397</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="398" data-right-line="277"><a>398</a> <span class="diffnew left">if stim_freq ~= round(stim_freq_check)                                           &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="399" data-right-line="277"><a>399</a> <span class="diffnew left">    warning('User input stimulus frequency does not match trigger frequency')    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="400" data-right-line="277"><a>400</a> <span class="diffnew left">end                                                                              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="401" data-right-line="277"><a>401</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="402" data-right-line="277"><a>402</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="403" data-right-line="278"><a>403</a> <span class="diffnomatch">stim_int<span style="background: #be96c6;">  </span>= 1/stim_freq; % sec                                                   x stim_int<span style="background: #be96c6;">   </span>= 1/stim_freq; % sec                                                 </span> <span><a>278</a></span></span>
<span class="diffLine" data-left-line="404" data-right-line="279"><a>404</a> <span class="diffnomatch">p.stim_int = stim_int;                                                           x p.stim_int = stim_int;<span style="background: #be96c6;"> % PAR Mod 17,09,2020</span>                                     </span> <span><a>279</a></span></span>
<span class="diffLine" data-left-line="404" data-right-line="280"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                                                                                 </span> <span><a>280</a></span></span>
</div><span class="nodiff" data-left-line="405" data-right-line="281"><a>405</a> if p.Time_Choice == 1 % stimulus frames                                          . if p.Time_Choice == 1 % stimulus frames                                          <span><a>281</a></span></span>
<span class="nodiff" data-left-line="406" data-right-line="282"><a>406</a>                                                                                  .                                                                                  <span><a>282</a></span></span>
<span class="nodiff" data-left-line="407" data-right-line="283"><a>407</a>     p.stim_timesample_vec = linspace(-stim_int*p.Num_STE_bins,-stim_int,p.Num_ST .     p.stim_timesample_vec = linspace(-stim_int*p.Num_STE_bins,-stim_int,p.Num_ST <span><a>283</a></span></span>
                                                                      <span class="diffskip">[75 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="483" data-right-line="359"><a>483</a> set(gca,'FontSize',12);                                                          . set(gca,'FontSize',12);                                                          <span><a>359</a></span></span>
<span class="nodiff" data-left-line="484" data-right-line="360"><a>484</a> set(gcf,'color','w');                                                            . set(gcf,'color','w');                                                            <span><a>360</a></span></span>
<span class="nodiff" data-left-line="485" data-right-line="361"><a>485</a>                                                                                  .                                                                                  <span><a>361</a></span></span>
<div id="diff35"><span class="diffLine" data-left-line="486" data-right-line="361"><a>486</a> <span class="diffnew left">%% Loop over batch                                                               &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="487" data-right-line="361"><a>487</a> <span class="diffnew left">%Load spiketimes according to the batch size defined above and set the save      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="488" data-right-line="361"><a>488</a> <span class="diffnew left">%parameters for the function output                                              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="489" data-right-line="362"><a>489</a>                                                                                  .                                                                                  <span><a>362</a></span></span>
<div id="diff36"><span class="diffLine" data-left-line="490" data-right-line="362"><a>490</a> <span class="diffnew left">h = waitbar(0,'Batch nr: ');                                                     &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="491" data-right-line="362"><a>491</a> <span class="diffnew left">% for bb = 1:batch_nr                                                            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="492" data-right-line="362"><a>492</a> <span class="diffnew left">Kernel_location = strings(stx_before,2);                                         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="493" data-right-line="362"><a>493</a> <span class="diffnew left">for bb = 1:batch_nr                                                              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="494" data-right-line="362"><a>494</a> <span class="diffnew left">    waitbar(bb/batch_nr,h,[num2str(bb),' of ', batch_nr]);                       &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="495" data-right-line="362"><a>495</a> <span class="diffnew left">%Initiate the batch                                                              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="496" data-right-line="362"><a>496</a> <span class="diffnew left">spiketimestamps = load_spiketimestamps_app (savepath, add_info,...               &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="497" data-right-line="362"><a>497</a> <span class="diffnew left">    'cell_subset',[batch_begins(bb),batch_ends(bb)]);                            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="498" data-right-line="362"><a>498</a> <span class="diffnew left">cell_indices_temp = cell_indices(batch_begins(bb):batch_ends(bb));               &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="499" data-right-line="362"><a>499</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="500" data-right-line="362"><a>500</a> <span class="diffnew left">%Quality Check                                                                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="501" data-right-line="362"><a>501</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="502" data-right-line="362"><a>502</a> <span class="diffnew left">% right_indices = quality_check_spikes(spiketimestamps,10); %This needs to be    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="503" data-right-line="362"><a>503</a> <span class="diffnew left">% %tested further;                                                               &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="504" data-right-line="362"><a>504</a> <span class="diffnew left">% spiketimestamps = spiketimestamps(:,right_indices);                            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="505" data-right-line="362"><a>505</a> <span class="diffnew left">%set times relative to stimulus begin                                            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="506" data-right-line="362"><a>506</a> <span class="diffnew left">spiketimestamps = spiketimestamps - noise_begin_s;                               &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="507" data-right-line="362"><a>507</a> <span class="diffnew left">%spiketimestamps(:,~any(~isnan(spiketimestamps))) = [];                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="508" data-right-line="362"><a>508</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="509" data-right-line="362"><a>509</a> <span class="diffnew left">stx = size(spiketimestamps,2);                                                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="510" data-right-line="362"><a>510</a> <span class="diffnew left">sty = size(spiketimestamps,1);                                                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="511" data-right-line="362"><a>511</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="512" data-right-line="362"><a>512</a> <span class="diffnew left">%cell_indices_temp = cell_indices_temp(1,right_indices);                         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="513" data-right-line="362"><a>513</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="514" data-right-line="363"><a>514</a> %% Call RF Identification Function                                               . %% Call RF Identification Function                                               <span><a>363</a></span></span>
<span class="nodiff" data-left-line="515" data-right-line="364"><a>515</a> % MEA data: stimulus_array := 40 rows, 40 columns,6000 frames, 4 colours         . % MEA data: stimulus_array := 40 rows, 40 columns,6000 frames, 4 colours         <span><a>364</a></span></span>
<div id="diff37"><span class="diffLine" data-left-line="516" data-right-line="364"><a>516</a> <span class="diffnew left">a = 1;                                                                           &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="517" data-right-line="364"><a>517</a> <span class="diffnew left">%RF_Ident = cell(stx,1);                                                         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="518" data-right-line="365"><a>518</a>                                                                                  .                                                                                  <span><a>365</a></span></span>
<div id="diff38"><span class="diffLine" data-left-line="518" data-right-line="366"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt; RF_Ident = cell(True_Num_Cells,1);                                              </span> <span><a>366</a></span></span>
<span class="diffLine" data-left-line="518" data-right-line="367"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                                                                                 </span> <span><a>367</a></span></span>
</div><span class="nodiff" data-left-line="519" data-right-line="368"><a>519</a> if p.RF_Ident_Meth_vec(1) == 1 % STA-SD method                                   . if p.RF_Ident_Meth_vec(1) == 1 % STA-SD method                                   <span><a>368</a></span></span>
<span class="nodiff" data-left-line="520" data-right-line="369"><a>520</a>     if p.STA_Choice  == 2 % subtract average stim                                .     if p.STA_Choice  == 2 % subtract average stim                                <span><a>369</a></span></span>
<span class="nodiff" data-left-line="521" data-right-line="370"><a>521</a>         p.mean_raw_stim_arr = NaN(p.stim_rows,p.stim_columns,p.Num_STE_bins,p.Sp .         p.mean_raw_stim_arr = NaN(p.stim_rows,p.stim_columns,p.Num_STE_bins,p.Sp <span><a>370</a></span></span>
                                                                       <span class="diffskip">[4 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="526" data-right-line="375"><a>526</a> end                                                                              . end                                                                              <span><a>375</a></span></span>
<span class="nodiff" data-left-line="527" data-right-line="376"><a>527</a>                                                                                  .                                                                                  <span><a>376</a></span></span>
<span class="nodiff" data-left-line="528" data-right-line="377"><a>528</a> tic;                                                                             . tic;                                                                             <span><a>377</a></span></span>
<div id="diff39"><span class="diffLine" data-left-line="529" data-right-line="378"><a>529</a> <span class="diffnomatch">if Parpool == 1 % Parpool on<span style="background: #be96c6;"> %@mars: This doesnt work if a parpool is already ac</span> x if Parpool == 1 % Parpool on                                                    </span> <span><a>378</a></span></span>
</div><span class="nodiff" data-left-line="530" data-right-line="379"><a>530</a>                                                                                  .                                                                                  <span><a>379</a></span></span>
<div id="diff40"><span class="diffLine" data-left-line="531" data-right-line="380"><a>531</a> <span class="diffnomatch">    <span style="background: #be96c6;">%</span>parpool(Num_Cores);                                                         x     parpool(Num_Cores);                                                         </span> <span><a>380</a></span></span>
</div><span class="nodiff" data-left-line="532" data-right-line="381"><a>532</a>                                                                                  .                                                                                  <span><a>381</a></span></span>
<div id="diff41"><span class="diffLine" data-left-line="533" data-right-line="382"><a>533</a> <span class="diffnomatch">    parfor i = 1:<span style="background: #be96c6;">stx</span> % for/parfor                                                x     parfor i = 1:<span style="background: #be96c6;">True_Num_Cells</span> % for/parfor                                    </span> <span><a>382</a></span></span>
<span class="diffLine" data-left-line="534" data-right-line="382"><a>534</a> <span class="diffnew left">        i                                                                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="535" data-right-line="382"><a>535</a> <span class="diffnew left">        settings = add_info;                                                     &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="536" data-right-line="382"><a>536</a> <span class="diffnew left">        p_par = p;                                                               &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="537" data-right-line="382"><a>537</a> <span class="diffnew left">        trig_times_vec_par = trig_times_vec; %@mars: added this declaration      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="538" data-right-line="382"><a>538</a> <span class="diffnew left">        %to avoid uneccessary communication between the workers in the parloop.  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="539" data-right-line="382"><a>539</a> <span class="diffnew left">        spike_times_vec_loop      = spiketimestamps(:,i);                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="540" data-right-line="382"><a>540</a> <span class="diffnew left">        %Check if all values are NAN                                             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="541" data-right-line="382"><a>541</a> <span class="diffnew left">        test_for_NaN = find(all(isnan(spike_times_vec_loop),1));                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="542" data-right-line="382"><a>542</a> <span class="diffnew left">        if test_for_NaN                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="543" data-right-line="382"><a>543</a> <span class="diffnew left">            RF_Ident(i).RF_results = NaN;                                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="544" data-right-line="382"><a>544</a> <span class="diffnew left">            RF_Ident(i).cell_idx = cell_indices_temp(i);                         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="545" data-right-line="383"><a>545</a> <span class="diffnomatch"><span style="background: #be96c6;">             </span>                                                                    x <span style="background: #be96c6;">        </span>                                                                        </span> <span><a>383</a></span></span>
<span class="diffLine" data-left-line="546" data-right-line="384"><a>546</a> <span class="diffnomatch"><span style="background: #be96c6;">            RF_Ident</span>(i)<span style="background: #be96c6;">.add_info = settings</span>;                                     x <span style="background: #be96c6;">        spike_times_vec_loop      = spike_times_mat</span>(<span style="background: #be96c6;">:,</span>i);                       </span> <span><a>384</a></span></span>
<span class="diffLine" data-left-line="547" data-right-line="384"><a>547</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="548" data-right-line="384"><a>548</a> <span class="diffnew left">            continue                                                             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="549" data-right-line="384"><a>549</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="550" data-right-line="384"><a>550</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="551" data-right-line="385"><a>551</a>         spike_times_vec_loop(isnan(spike_times_vec_loop)) = []; % spiketimestamp .         spike_times_vec_loop(isnan(spike_times_vec_loop)) = []; % spiketimestamp <span><a>385</a></span></span>
<span class="nodiff" data-left-line="552" data-right-line="386"><a>552</a>         spike_times_vec_loop      = spike_times_vec_loop(spike_times_vec_loop&gt;(f .         spike_times_vec_loop      = spike_times_vec_loop(spike_times_vec_loop&gt;(f <span><a>386</a></span></span>
<div id="diff42"><span class="diffLine" data-left-line="552" data-right-line="387"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;         if (Num_Trig_Final_NoiseChunk &gt;= p.Num_STE_bins + 1) || (Num_Trig_Final_</span> <span><a>387</a></span></span>
<span class="diffLine" data-left-line="553" data-right-line="388"><a>553</a> <span class="diffnomatch"><span style="background: #be96c6;">        %</span>spike_times_vec_loop      = spike_times_vec_loop(spike_times_vec_loop&lt;( x <span style="background: #be96c6;">            </span>spike_times_vec_loop      = spike_times_vec_loop(spike_times_vec_loo</span> <span><a>388</a></span></span>
<span class="diffLine" data-left-line="554" data-right-line="388"><a>554</a> <span class="diffnew left">        if (nr_trig_last_repeat &gt;= p.Num_STE_bins + 1) || (nr_trig_last_repeat = &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="555" data-right-line="388"><a>555</a> <span class="diffnew left">            spike_times_vec_loop      = spike_times_vec_loop(spike_times_vec_loo &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="556" data-right-line="389"><a>556</a>         else % Num_Trig_Final_NoiseChunk &lt; p.Num_STE_bins + 1                    .         else % Num_Trig_Final_NoiseChunk &lt; p.Num_STE_bins + 1                    <span><a>389</a></span></span>
<span class="nodiff" data-left-line="557" data-right-line="390"><a>557</a>             spike_times_vec_loop      = spike_times_vec_loop(spike_times_vec_loo .             spike_times_vec_loop      = spike_times_vec_loop(spike_times_vec_loo <span><a>390</a></span></span>
<span class="nodiff" data-left-line="558" data-right-line="391"><a>558</a>         end                                                                      .         end                                                                      <span><a>391</a></span></span>
<span class="nodiff" data-left-line="559" data-right-line="392"><a>559</a>                                                                                  .                                                                                  <span><a>392</a></span></span>
<div id="diff43"><span class="diffLine" data-left-line="559" data-right-line="393"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;         if p.Num_trigs &gt; p.stim_frames % Frozen noise repeated case % PAR Mod 27</span> <span><a>393</a></span></span>
<span class="diffLine" data-left-line="560" data-right-line="394"><a>560</a> <span class="diffnomatch"><span style="background: #be96c6;">        </span>                                                                         x <span style="background: #be96c6;">            </span>                                                                    </span> <span><a>394</a></span></span>
<span class="diffLine" data-left-line="560" data-right-line="395"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;             if sum(inter_noise_int_vec &lt;= max_trig_int) == p.Num_FNoise_rep_ceil</span> <span><a>395</a></span></span>
<span class="diffLine" data-left-line="561" data-right-line="396"><a>561</a> <span class="diffnomatch"><span style="background: #be96c6;">        </span>                                                                         x <span style="background: #be96c6;">                </span>                                                                </span> <span><a>396</a></span></span>
<span class="diffLine" data-left-line="562" data-right-line="396"><a>562</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="563" data-right-line="396"><a>563</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="564" data-right-line="396"><a>564</a> <span class="diffnew left">        if p_par.Num_trigs &gt; p_par.stim_frames % Frozen noise repeated case % PA &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="565" data-right-line="396"><a>565</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="566" data-right-line="396"><a>566</a> <span class="diffnew left">            if sum(inter_noise_int_vec &lt;= max_trig_int) == p_par.Num_FNoise_rep_ &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="567" data-right-line="396"><a>567</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="568" data-right-line="397"><a>568</a>                 % No need to remove further spikes in this case                  .                 % No need to remove further spikes in this case                  <span><a>397</a></span></span>
<span class="nodiff" data-left-line="569" data-right-line="398"><a>569</a>                                                                                  .                                                                                  <span><a>398</a></span></span>
<div id="diff44"><span class="diffLine" data-left-line="570" data-right-line="399"><a>570</a> <span class="diffnomatch">                for j = 2:<span style="background: #be96c6;">p_par</span>.Num_FNoise_rep_ceil % map spikes in repeated sti x                 for j = 2:<span style="background: #be96c6;">p</span>.Num_FNoise_rep_ceil % map spikes in repeated stimulu</span> <span><a>399</a></span></span>
</div><span class="nodiff" data-left-line="571" data-right-line="400"><a>571</a>                                                                                  .                                                                                  <span><a>400</a></span></span>
<div id="diff45"><span class="diffLine" data-left-line="572" data-right-line="401"><a>572</a> <span class="diffnomatch">                    if j==<span style="background: #be96c6;">p_par</span>.Num_FNoise_rep_ceil                              x                     if j==<span style="background: #be96c6;">p</span>.Num_FNoise_rep_ceil                                 </span> <span><a>401</a></span></span>
<span class="diffLine" data-left-line="573" data-right-line="402"><a>573</a> <span class="diffnomatch">                        frame_end_loop = <span style="background: #be96c6;">p_par</span>.Num_trigs - <span style="background: #be96c6;">p_par</span>.stim_frames*(<span style="background: #be96c6;">p_</span> x                         frame_end_loop = <span style="background: #be96c6;">p</span>.Num_trigs - <span style="background: #be96c6;">p</span>.stim_frames*(<span style="background: #be96c6;">p</span>.Num_FNoi</span> <span><a>402</a></span></span>
</div><span class="nodiff" data-left-line="574" data-right-line="403"><a>574</a>                     else                                                         .                     else                                                         <span><a>403</a></span></span>
<div id="diff46"><span class="diffLine" data-left-line="575" data-right-line="404"><a>575</a> <span class="diffnomatch">                        frame_end_loop = <span style="background: #be96c6;">p_par</span>.stim_frames;                      x                         frame_end_loop = <span style="background: #be96c6;">p</span>.stim_frames;                         </span> <span><a>404</a></span></span>
</div><span class="nodiff" data-left-line="576" data-right-line="405"><a>576</a>                     end                                                          .                     end                                                          <span><a>405</a></span></span>
<span class="nodiff" data-left-line="577" data-right-line="406"><a>577</a>                                                                                  .                                                                                  <span><a>406</a></span></span>
<div id="diff47"><span class="diffLine" data-left-line="578" data-right-line="407"><a>578</a> <span class="diffnomatch"><span style="background: #be96c6;">                    </span>for k = 1:frame_end_loop                                     x <span style="background: #be96c6;">                   </span>for k = 1:frame_end_loop                                     </span> <span><a>407</a></span></span>
<span class="diffLine" data-left-line="579" data-right-line="408"><a>579</a> <span class="diffnomatch">                        if (k &lt; frame_end_loop) || (j &lt; <span style="background: #be96c6;">p_par</span>.Num_FNoise_rep_cei x                         if (k &lt; frame_end_loop) || (j &lt; <span style="background: #be96c6;">p</span>.Num_FNoise_rep_ceil)  </span> <span><a>408</a></span></span>
<span class="diffLine" data-left-line="580" data-right-line="409"><a>580</a> <span class="diffnomatch">                            indices_loop = find((spike_times_vec_loop&gt;<span style="background: #be96c6;">trig_times</span> x                             indices_loop = find((spike_times_vec_loop&gt;<span style="background: #be96c6;">trig_times</span></span> <span><a>409</a></span></span>
<span class="diffLine" data-left-line="581" data-right-line="410"><a>581</a> <span class="diffnomatch">                            a_loop      = <span style="background: #be96c6;">trig_times_vec_par</span>(k);                 x                             a_loop      = <span style="background: #be96c6;">trig_times_vec</span>(k);                    </span> <span><a>410</a></span></span>
<span class="diffLine" data-left-line="582" data-right-line="411"><a>582</a> <span class="diffnomatch">                            b_loop      = <span style="background: #be96c6;">trig_times_vec_par</span>(k+1);               x                             b_loop      = <span style="background: #be96c6;">trig_times_vec</span>(k+1);                  </span> <span><a>411</a></span></span>
<span class="diffLine" data-left-line="583" data-right-line="412"><a>583</a> <span class="diffnomatch">                            a_dash_loop = <span style="background: #be96c6;">trig_times_vec_par</span>((j-1)*<span style="background: #be96c6;">p_par</span>.stim_fr x                             a_dash_loop = <span style="background: #be96c6;">trig_times_vec</span>((j-1)*<span style="background: #be96c6;">p</span>.stim_frames + k</span> <span><a>412</a></span></span>
<span class="diffLine" data-left-line="584" data-right-line="413"><a>584</a> <span class="diffnomatch">                            b_dash_loop = <span style="background: #be96c6;">trig_times_vec_par</span>((j-1)*<span style="background: #be96c6;">p_par</span>.stim_fr x                             b_dash_loop = <span style="background: #be96c6;">trig_times_vec</span>((j-1)*<span style="background: #be96c6;">p</span>.stim_frames + k</span> <span><a>413</a></span></span>
<span class="diffLine" data-left-line="585" data-right-line="414"><a>585</a> <span class="diffnomatch">                            %spike_times_vec_loop(indices_loop) = a_loop + (spik x                             %spike_times_vec_loop(indices_loop) = a_loop + (spik</span> <span><a>414</a></span></span>
</div><span class="nodiff" data-left-line="586" data-right-line="415"><a>586</a>                         else % (k == frame_end_loop) &amp;&amp; (j == p.Num_FNoise_rep_c .                         else % (k == frame_end_loop) &amp;&amp; (j == p.Num_FNoise_rep_c <span><a>415</a></span></span>
<div id="diff48"><span class="diffLine" data-left-line="587" data-right-line="416"><a>587</a> <span class="diffnomatch">                            indices_loop = find((spike_times_vec_loop&gt;<span style="background: #be96c6;">trig_times</span> x                             indices_loop = find((spike_times_vec_loop&gt;<span style="background: #be96c6;">trig_times</span></span> <span><a>416</a></span></span>
<span class="diffLine" data-left-line="588" data-right-line="417"><a>588</a> <span class="diffnomatch">                            a_loop      = <span style="background: #be96c6;">trig_times_vec_par</span>(k);                 x                             a_loop      = <span style="background: #be96c6;">trig_times_vec</span>(k);                    </span> <span><a>417</a></span></span>
<span class="diffLine" data-left-line="589" data-right-line="418"><a>589</a> <span class="diffnomatch">                            b_loop      = <span style="background: #be96c6;">trig_times_vec_par</span>(k+1);               x                             b_loop      = <span style="background: #be96c6;">trig_times_vec</span>(k+1);                  </span> <span><a>418</a></span></span>
<span class="diffLine" data-left-line="590" data-right-line="419"><a>590</a> <span class="diffnomatch">                            a_dash_loop = <span style="background: #be96c6;">trig_times_vec_par</span>((j-1)*<span style="background: #be96c6;">p_par</span>.stim_fr x                             a_dash_loop = <span style="background: #be96c6;">trig_times_vec</span>((j-1)*<span style="background: #be96c6;">p</span>.stim_frames + k</span> <span><a>419</a></span></span>
<span class="diffLine" data-left-line="591" data-right-line="420"><a>591</a> <span class="diffnomatch">                            b_dash_loop = <span style="background: #be96c6;">trig_times_vec_par</span>((j-1)*<span style="background: #be96c6;">p_par</span>.stim_fr x                             b_dash_loop = <span style="background: #be96c6;">trig_times_vec</span>((j-1)*<span style="background: #be96c6;">p</span>.stim_frames + k</span> <span><a>420</a></span></span>
<span class="diffLine" data-left-line="592" data-right-line="421"><a>592</a> <span class="diffnomatch">                            %spike_times_vec_loop(indices_loop) = a_loop + (spik x                             %spike_times_vec_loop(indices_loop) = a_loop + (spik</span> <span><a>421</a></span></span>
</div><span class="nodiff" data-left-line="593" data-right-line="422"><a>593</a>                         end                                                      .                         end                                                      <span><a>422</a></span></span>
<span class="nodiff" data-left-line="594" data-right-line="423"><a>594</a>                         spike_times_vec_loop(indices_loop) = a_loop + (spike_tim .                         spike_times_vec_loop(indices_loop) = a_loop + (spike_tim <span><a>423</a></span></span>
<span class="nodiff" data-left-line="595" data-right-line="424"><a>595</a>                     end                                                          .                     end                                                          <span><a>424</a></span></span>
<div id="diff49"><span class="diffLine" data-left-line="596" data-right-line="424"><a>596</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="597" data-right-line="425"><a>597</a>                 end                                                              .                 end                                                              <span><a>425</a></span></span>
<div id="diff50"><span class="diffLine" data-left-line="598" data-right-line="425"><a>598</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="599" data-right-line="425"><a>599</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="600" data-right-line="426"><a>600</a> <span class="diffnomatch"><span style="background: #be96c6;">                 </span>% Map spike in interval after last stimulus window % PAR Mod 17 x <span style="background: #be96c6;">                </span>% Map spike in interval after last stimulus window % PAR Mod 17,</span> <span><a>426</a></span></span>
</div><span class="nodiff" data-left-line="601" data-right-line="427"><a>601</a>                 indices_loop = find((spike_times_vec_loop&gt;trig_times_vec(p.Num_t .                 indices_loop = find((spike_times_vec_loop&gt;trig_times_vec(p.Num_t <span><a>427</a></span></span>
<span class="nodiff" data-left-line="602" data-right-line="428"><a>602</a>                                    &amp;(spike_times_vec_loop&lt;trig_times_vec(p.Num_t .                                    &amp;(spike_times_vec_loop&lt;trig_times_vec(p.Num_t <span><a>428</a></span></span>
<span class="nodiff" data-left-line="603" data-right-line="429"><a>603</a>                 a_loop      = trig_times_vec(1);                                 .                 a_loop      = trig_times_vec(1);                                 <span><a>429</a></span></span>
                                                                       <span class="diffskip">[4 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="608" data-right-line="434"><a>608</a>                                                                                  .                                                                                  <span><a>434</a></span></span>
<span class="nodiff" data-left-line="609" data-right-line="435"><a>609</a>             else % If there are gaps between (any) frozen noise chuncks          .             else % If there are gaps between (any) frozen noise chuncks          <span><a>435</a></span></span>
<span class="nodiff" data-left-line="610" data-right-line="436"><a>610</a>                                                                                  .                                                                                  <span><a>436</a></span></span>
<div id="diff51"><span class="diffLine" data-left-line="611" data-right-line="437"><a>611</a> <span class="diffnomatch">                if (<span style="background: #be96c6;">nr_trig_last_repeat</span> &gt;= p.Num_STE_bins + 1) || (<span style="background: #be96c6;">nr_trig_last_</span> x                 if (<span style="background: #be96c6;">Num_Trig_Final_NoiseChunk</span> &gt;= p.Num_STE_bins + 1) || (<span style="background: #be96c6;">Num_Tri</span></span> <span><a>437</a></span></span>
</div><span class="nodiff" data-left-line="612" data-right-line="438"><a>612</a>                     for j = 1:p.Num_FNoise_rep_ceil-1 % remove spikes with stimu .                     for j = 1:p.Num_FNoise_rep_ceil-1 % remove spikes with stimu <span><a>438</a></span></span>
<span class="nodiff" data-left-line="613" data-right-line="439"><a>613</a>                         spike_times_vec_loop((spike_times_vec_loop&gt;(trig_times_v .                         spike_times_vec_loop((spike_times_vec_loop&gt;(trig_times_v <span><a>439</a></span></span>
<span class="nodiff" data-left-line="614" data-right-line="440"><a>614</a>                     end                                                          .                     end                                                          <span><a>440</a></span></span>
<div id="diff52"><span class="diffLine" data-left-line="615" data-right-line="440"><a>615</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="616" data-right-line="441"><a>616</a>                 elseif p.Num_FNoise_rep_ceil&gt;2 % still need to remove spike betw .                 elseif p.Num_FNoise_rep_ceil&gt;2 % still need to remove spike betw <span><a>441</a></span></span>
<span class="nodiff" data-left-line="617" data-right-line="442"><a>617</a>                     for j = 1:p.Num_FNoise_rep_ceil-2 % remove spikes with stimu .                     for j = 1:p.Num_FNoise_rep_ceil-2 % remove spikes with stimu <span><a>442</a></span></span>
<span class="nodiff" data-left-line="618" data-right-line="443"><a>618</a>                         spike_times_vec_loop((spike_times_vec_loop&gt;(trig_times_v .                         spike_times_vec_loop((spike_times_vec_loop&gt;(trig_times_v <span><a>443</a></span></span>
<span class="nodiff" data-left-line="619" data-right-line="444"><a>619</a>                     end                                                          .                     end                                                          <span><a>444</a></span></span>
<span class="nodiff" data-left-line="620" data-right-line="445"><a>620</a>                 end                                                              .                 end                                                              <span><a>445</a></span></span>
<span class="nodiff" data-left-line="621" data-right-line="446"><a>621</a>                                                                                  .                                                                                  <span><a>446</a></span></span>
<div id="diff53"><span class="diffLine" data-left-line="622" data-right-line="447"><a>622</a> <span class="diffnomatch">                for j = 2:<span style="background: #be96c6;">p_par</span>.Num_FNoise_rep_ceil % map spikes in repeated sti x                 for j = 2:<span style="background: #be96c6;">p</span>.Num_FNoise_rep_ceil % map spikes in repeated stimulu</span> <span><a>447</a></span></span>
</div><span class="nodiff" data-left-line="623" data-right-line="448"><a>623</a>                                                                                  .                                                                                  <span><a>448</a></span></span>
<div id="diff54"><span class="diffLine" data-left-line="624" data-right-line="449"><a>624</a> <span class="diffnomatch">                    if j==<span style="background: #be96c6;">p_par</span>.Num_FNoise_rep_ceil                              x                     if j==<span style="background: #be96c6;">p</span>.Num_FNoise_rep_ceil                                 </span> <span><a>449</a></span></span>
<span class="diffLine" data-left-line="625" data-right-line="450"><a>625</a> <span class="diffnomatch">                        frame_end_loop = <span style="background: #be96c6;">p_par</span>.Num_trigs - <span style="background: #be96c6;">p_par</span>.stim_frames*(<span style="background: #be96c6;">p_</span> x                         frame_end_loop = <span style="background: #be96c6;">p</span>.Num_trigs - <span style="background: #be96c6;">p</span>.stim_frames*(<span style="background: #be96c6;">p</span>.Num_FNoi</span> <span><a>450</a></span></span>
</div><span class="nodiff" data-left-line="626" data-right-line="451"><a>626</a>                     else                                                         .                     else                                                         <span><a>451</a></span></span>
<div id="diff55"><span class="diffLine" data-left-line="627" data-right-line="452"><a>627</a> <span class="diffnomatch">                        frame_end_loop = <span style="background: #be96c6;">p_par</span>.stim_frames;                      x                         frame_end_loop = <span style="background: #be96c6;">p</span>.stim_frames;                         </span> <span><a>452</a></span></span>
</div><span class="nodiff" data-left-line="628" data-right-line="453"><a>628</a>                     end                                                          .                     end                                                          <span><a>453</a></span></span>
<span class="nodiff" data-left-line="629" data-right-line="454"><a>629</a>                                                                                  .                                                                                  <span><a>454</a></span></span>
<div id="diff56"><span class="diffLine" data-left-line="630" data-right-line="455"><a>630</a> <span class="diffnomatch">                    for k = 1:frame_end_loop+1                                   x                     for k = 1:frame_end_loop+1<span style="background: #be96c6;"> % PAR Mod 17,09,2020 (was 1:frame</span></span> <span><a>455</a></span></span>
</div><span class="nodiff" data-left-line="631" data-right-line="456"><a>631</a>                         if k&lt;frame_end_loop % frame_end_loop&lt;p.stim_frames       .                         if k&lt;frame_end_loop % frame_end_loop&lt;p.stim_frames       <span><a>456</a></span></span>
<div id="diff57"><span class="diffLine" data-left-line="632" data-right-line="457"><a>632</a> <span class="diffnomatch">                                                                                 x                             <span style="background: #be96c6;">indices_loop = find((spike_times_vec_loop&gt;trig_times</span></span> <span><a>457</a></span></span>
<span class="diffLine" data-left-line="633" data-right-line="457"><a>633</a> <span class="diffnew left">                            indices_loop = find((spike_times_vec_loop&gt;=trig_time &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="634" data-right-line="458"><a>634</a>                             a_loop      = trig_times_vec(k);                     .                             a_loop      = trig_times_vec(k);                     <span><a>458</a></span></span>
<span class="nodiff" data-left-line="635" data-right-line="459"><a>635</a>                             b_loop      = trig_times_vec(k+1);                   .                             b_loop      = trig_times_vec(k+1);                   <span><a>459</a></span></span>
<div id="diff58"><span class="diffLine" data-left-line="636" data-right-line="460"><a>636</a> <span class="diffnomatch">                            a_dash_loop = trig_times_vec((j-1)*<span style="background: #be96c6;">p_par</span>.stim_frames x                             a_dash_loop = trig_times_vec((j-1)*<span style="background: #be96c6;">p</span>.stim_frames + k</span> <span><a>460</a></span></span>
<span class="diffLine" data-left-line="637" data-right-line="461"><a>637</a> <span class="diffnomatch">                            b_dash_loop = trig_times_vec((j-1)*<span style="background: #be96c6;">p_par</span>.stim_frames x                             b_dash_loop = trig_times_vec((j-1)*<span style="background: #be96c6;">p</span>.stim_frames + k</span> <span><a>461</a></span></span>
<span class="diffLine" data-left-line="638" data-right-line="462"><a>638</a> <span class="diffnomatch">                            %spike_times_vec_loop(indices_loop) = a_loop + (spik x                             %spike_times_vec_loop(indices_loop) = a_loop + (spik</span> <span><a>462</a></span></span>
<span class="diffLine" data-left-line="639" data-right-line="463"><a>639</a> <span class="diffnomatch"><span style="background: #be96c6;">                       </span>elseif  k==frame_end_loop % No end time is given for the  x <span style="background: #be96c6;">                        </span>elseif  k==frame_end_loop % No end time is given for the</span> <span><a>463</a></span></span>
</div><span class="nodiff" data-left-line="640" data-right-line="464"><a>640</a>                             indices_loop = find((spike_times_vec_loop&gt;trig_times .                             indices_loop = find((spike_times_vec_loop&gt;trig_times <span><a>464</a></span></span>
<span class="nodiff" data-left-line="641" data-right-line="465"><a>641</a>                             a_loop      = trig_times_vec(k);                     .                             a_loop      = trig_times_vec(k);                     <span><a>465</a></span></span>
<span class="nodiff" data-left-line="642" data-right-line="466"><a>642</a>                             b_loop      = trig_times_vec(k) + stim_int; % PAR Mo .                             b_loop      = trig_times_vec(k) + stim_int; % PAR Mo <span><a>466</a></span></span>
<div id="diff59"><span class="diffLine" data-left-line="643" data-right-line="467"><a>643</a> <span class="diffnomatch">                            a_dash_loop = trig_times_vec((j-1)*<span style="background: #be96c6;">p_par</span>.stim_frames x                             a_dash_loop = trig_times_vec((j-1)*<span style="background: #be96c6;">p</span>.stim_frames + k</span> <span><a>467</a></span></span>
<span class="diffLine" data-left-line="644" data-right-line="468"><a>644</a> <span class="diffnomatch">                            b_dash_loop = trig_times_vec((j-1)*<span style="background: #be96c6;">p_par</span>.stim_frames x                             b_dash_loop = trig_times_vec((j-1)*<span style="background: #be96c6;">p</span>.stim_frames + k</span> <span><a>468</a></span></span>
<span class="diffLine" data-left-line="645" data-right-line="469"><a>645</a> <span class="diffnomatch">                            %spike_times_vec_loop(indices_loop) = a_loop + (spik x                             %spike_times_vec_loop(indices_loop) = a_loop + (spik</span> <span><a>469</a></span></span>
<span class="diffLine" data-left-line="646" data-right-line="469"><a>646</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="647" data-right-line="470"><a>647</a>                         else % k==frame_end_loop+1 % PAR Mod 17,09,2020 (everyth .                         else % k==frame_end_loop+1 % PAR Mod 17,09,2020 (everyth <span><a>470</a></span></span>
<span class="nodiff" data-left-line="648" data-right-line="471"><a>648</a>                             indices_loop = find((spike_times_vec_loop&gt;trig_times .                             indices_loop = find((spike_times_vec_loop&gt;trig_times <span><a>471</a></span></span>
<span class="nodiff" data-left-line="649" data-right-line="472"><a>649</a>                                                &amp;(spike_times_vec_loop&lt;trig_times .                                                &amp;(spike_times_vec_loop&lt;trig_times <span><a>472</a></span></span>
                                                                       <span class="diffskip">[8 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="658" data-right-line="481"><a>658</a>                                 a_dash_loop = trig_times_vec((j-1)*p.stim_frames .                                 a_dash_loop = trig_times_vec((j-1)*p.stim_frames <span><a>481</a></span></span>
<span class="nodiff" data-left-line="659" data-right-line="482"><a>659</a>                                 b_dash_loop = trig_times_vec((j-1)*p.stim_frames .                                 b_dash_loop = trig_times_vec((j-1)*p.stim_frames <span><a>482</a></span></span>
<span class="nodiff" data-left-line="660" data-right-line="483"><a>660</a>                             end                                                  .                             end                                                  <span><a>483</a></span></span>
<div id="diff60"><span class="diffLine" data-left-line="660" data-right-line="484"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                         end                                                     </span> <span><a>484</a></span></span>
<span class="diffLine" data-left-line="661" data-right-line="485"><a>661</a> <span class="diffnomatch"><span style="background: #be96c6;">                             </span>spike_times_vec_loop(indices_loop) = a_loop + (spik x <span style="background: #be96c6;">                        </span>spike_times_vec_loop(indices_loop) = a_loop + (spike_tim</span> <span><a>485</a></span></span>
<span class="diffLine" data-left-line="662" data-right-line="486"><a>662</a> <span class="diffnomatch"><span style="background: #be96c6;">                        </span>end<span style="background: #be96c6;">    </span>                                                  x <span style="background: #be96c6;">                    </span>end                                                         </span> <span><a>486</a></span></span>
<span class="diffLine" data-left-line="663" data-right-line="487"><a>663</a> <span class="diffnomatch"><span style="background: #be96c6;">                                        </span>                                         x <span style="background: #be96c6;">                    </span>                                                            </span> <span><a>487</a></span></span>
<span class="diffLine" data-left-line="664" data-right-line="487"><a>664</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="665" data-right-line="488"><a>665</a> <span class="diffnomatch"><span style="background: #be96c6;">                    </span>end                                                          x <span style="background: #be96c6;">                </span>end                                                             </span> <span><a>488</a></span></span>
<span class="diffLine" data-left-line="666" data-right-line="489"><a>666</a> <span class="diffnomatch"><span style="background: #be96c6;">                    </span>                                                             x <span style="background: #be96c6;">                </span>                                                                </span> <span><a>489</a></span></span>
<span class="diffLine" data-left-line="667" data-right-line="490"><a>667</a> <span class="diffnomatch"><span style="background: #be96c6;">                </span>end                                                              x <span style="background: #be96c6;">            </span>end                                                                 </span> <span><a>490</a></span></span>
<span class="diffLine" data-left-line="668" data-right-line="491"><a>668</a> <span class="diffnomatch"><span style="background: #be96c6;">                </span>                                                                 x <span style="background: #be96c6;">            </span>                                                                    </span> <span><a>491</a></span></span>
<span class="diffLine" data-left-line="669" data-right-line="492"><a>669</a> <span class="diffnomatch"><span style="background: #be96c6;">            </span>end                                                                  x <span style="background: #be96c6;">        </span>end                                                                     </span> <span><a>492</a></span></span>
<span class="diffLine" data-left-line="670" data-right-line="493"><a>670</a> <span class="diffnomatch"><span style="background: #be96c6;">            </span>                                                                     x <span style="background: #be96c6;">        </span>                                                                        </span> <span><a>493</a></span></span>
<span class="diffLine" data-left-line="671" data-right-line="493"><a>671</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="672" data-right-line="493"><a>672</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="673" data-right-line="494"><a>673</a>         %p.length_spike_times      = length(spike_times_vec_loop);               .         %p.length_spike_times      = length(spike_times_vec_loop);               <span><a>494</a></span></span>
<span class="nodiff" data-left-line="674" data-right-line="495"><a>674</a>         length_spike_times_loop   = length(spike_times_vec_loop); % To allow par .         length_spike_times_loop   = length(spike_times_vec_loop); % To allow par <span><a>495</a></span></span>
<span class="nodiff" data-left-line="675" data-right-line="496"><a>675</a>                                                                                  .                                                                                  <span><a>496</a></span></span>
<div id="diff61"><span class="diffLine" data-left-line="676" data-right-line="497"><a>676</a> <span class="diffnomatch">        <span style="background: #be96c6;">%</span>RF_Ident{i} = <span style="background: #be96c6;">RF_Ident_fn_v5</span>(stimulus_arr,trig_times_vec_trunc,spike_ti x         RF_Ident{i} = <span style="background: #be96c6;">RF_Ident_fn_v6</span>(stimulus_arr,trig_times_vec_trunc,spike_tim</span> <span><a>497</a></span></span>
<span class="diffLine" data-left-line="677" data-right-line="497"><a>677</a> <span class="diffnew left">        RF_Ident(i).RF_results = RF_Ident_fn_v6(stimulus_arr,trig_times_vec_trun &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="678" data-right-line="497"><a>678</a> <span class="diffnew left">        RF_Ident(i).cell_idx = cell_indices_temp(i);                             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="679" data-right-line="498"><a>679</a>                                                                                  .                                                                                  <span><a>498</a></span></span>
<div id="diff62"><span class="diffLine" data-left-line="680" data-right-line="498"><a>680</a> <span class="diffnew left">        RF_Ident(i).add_info = settings.settings.kernel_new;                     &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="681" data-right-line="498"><a>681</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="682" data-right-line="498"><a>682</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="683" data-right-line="498"><a>683</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="684" data-right-line="498"><a>684</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="685" data-right-line="499"><a>685</a>         disp(i);                                                                 .         disp(i);                                                                 <span><a>499</a></span></span>
<span class="nodiff" data-left-line="686" data-right-line="500"><a>686</a>                                                                                  .                                                                                  <span><a>500</a></span></span>
<span class="nodiff" data-left-line="687" data-right-line="501"><a>687</a>     end                                                                          .     end                                                                          <span><a>501</a></span></span>
                                                                       <span class="diffskip">[4 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="692" data-right-line="506"><a>692</a>                                                                                  .                                                                                  <span><a>506</a></span></span>
<span class="nodiff" data-left-line="693" data-right-line="507"><a>693</a>     for i = 1:True_Num_Cells                                                     .     for i = 1:True_Num_Cells                                                     <span><a>507</a></span></span>
<span class="nodiff" data-left-line="694" data-right-line="508"><a>694</a>                                                                                  .                                                                                  <span><a>508</a></span></span>
<div id="diff63"><span class="diffLine" data-left-line="695" data-right-line="509"><a>695</a> <span class="diffnomatch">        spike_times_vec_loop      = <span style="background: #be96c6;">spiketimestamps</span>(:,i);                        x         spike_times_vec_loop      = <span style="background: #be96c6;">spike_times_mat</span>(:,i);                       </span> <span><a>509</a></span></span>
<span class="diffLine" data-left-line="696" data-right-line="509"><a>696</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="697" data-right-line="509"><a>697</a> <span class="diffnew left">        test_for_NaN = find(all(isnan(spike_times_vec_loop),1));                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="698" data-right-line="509"><a>698</a> <span class="diffnew left">        if test_for_NaN                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="699" data-right-line="509"><a>699</a> <span class="diffnew left">            RF_Ident(i).RF_results = NaN;                                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="700" data-right-line="509"><a>700</a> <span class="diffnew left">            RF_Ident(i).cell_idx = cell_indices_temp(i);                         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="701" data-right-line="509"><a>701</a> <span class="diffnew left">            if i == 1&amp;&amp; bb == 1                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="702" data-right-line="509"><a>702</a> <span class="diffnew left">                RF_Ident(i).add_info = add_info.settings.kernel_new;             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="703" data-right-line="509"><a>703</a> <span class="diffnew left">            end                                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="704" data-right-line="509"><a>704</a> <span class="diffnew left">            continue                                                             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="705" data-right-line="509"><a>705</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="706" data-right-line="509"><a>706</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="707" data-right-line="510"><a>707</a>         spike_times_vec_loop(isnan(spike_times_vec_loop)) = []; % spiketimestamp .         spike_times_vec_loop(isnan(spike_times_vec_loop)) = []; % spiketimestamp <span><a>510</a></span></span>
<span class="nodiff" data-left-line="708" data-right-line="511"><a>708</a>         spike_times_vec_loop      = spike_times_vec_loop(spike_times_vec_loop&gt;(f .         spike_times_vec_loop      = spike_times_vec_loop(spike_times_vec_loop&gt;(f <span><a>511</a></span></span>
<div id="diff64"><span class="diffLine" data-left-line="708" data-right-line="512"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;         if (Num_Trig_Final_NoiseChunk &gt;= p.Num_STE_bins + 1) || (Num_Trig_Final_</span> <span><a>512</a></span></span>
<span class="diffLine" data-left-line="709" data-right-line="513"><a>709</a> <span class="diffnomatch"><span style="background: #be96c6;">        </span>spike_times_vec_loop      = spike_times_vec_loop(spike_times_vec_loop&lt;(l x <span style="background: #be96c6;">            </span>spike_times_vec_loop      = spike_times_vec_loop(spike_times_vec_loo</span> <span><a>513</a></span></span>
<span class="diffLine" data-left-line="709" data-right-line="514"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;         else % Num_Trig_Final_NoiseChunk &lt; p.Num_STE_bins + 1                   </span> <span><a>514</a></span></span>
<span class="diffLine" data-left-line="709" data-right-line="515"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;             spike_times_vec_loop      = spike_times_vec_loop(spike_times_vec_loo</span> <span><a>515</a></span></span>
<span class="diffLine" data-left-line="709" data-right-line="516"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;         end                                                                     </span> <span><a>516</a></span></span>
</div><span class="nodiff" data-left-line="710" data-right-line="517"><a>710</a>                                                                                  .                                                                                  <span><a>517</a></span></span>
<span class="nodiff" data-left-line="711" data-right-line="518"><a>711</a>         if p.Num_trigs &gt; p.stim_frames % Frozen noise repeated case % PAR Mod 27 .         if p.Num_trigs &gt; p.stim_frames % Frozen noise repeated case % PAR Mod 27 <span><a>518</a></span></span>
<span class="nodiff" data-left-line="712" data-right-line="519"><a>712</a>                                                                                  .                                                                                  <span><a>519</a></span></span>
                                                                      <span class="diffskip">[16 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="729" data-right-line="536"><a>729</a>                             b_loop      = trig_times_vec(k+1);                   .                             b_loop      = trig_times_vec(k+1);                   <span><a>536</a></span></span>
<span class="nodiff" data-left-line="730" data-right-line="537"><a>730</a>                             a_dash_loop = trig_times_vec((j-1)*p.stim_frames + k .                             a_dash_loop = trig_times_vec((j-1)*p.stim_frames + k <span><a>537</a></span></span>
<span class="nodiff" data-left-line="731" data-right-line="538"><a>731</a>                             b_dash_loop = trig_times_vec((j-1)*p.stim_frames + k .                             b_dash_loop = trig_times_vec((j-1)*p.stim_frames + k <span><a>538</a></span></span>
<div id="diff65"><span class="diffLine" data-left-line="732" data-right-line="539"><a>732</a> <span class="diffnomatch">                            spike_times_vec_loop(indices_loop) = a_loop + (spike x                             <span style="background: #be96c6;">%</span>spike_times_vec_loop(indices_loop) = a_loop + (spik</span> <span><a>539</a></span></span>
</div><span class="nodiff" data-left-line="733" data-right-line="540"><a>733</a>                         else % (k == frame_end_loop) &amp;&amp; (j == p.Num_FNoise_rep_c .                         else % (k == frame_end_loop) &amp;&amp; (j == p.Num_FNoise_rep_c <span><a>540</a></span></span>
<span class="nodiff" data-left-line="734" data-right-line="541"><a>734</a>                             indices_loop = find((spike_times_vec_loop&gt;trig_times .                             indices_loop = find((spike_times_vec_loop&gt;trig_times <span><a>541</a></span></span>
<span class="nodiff" data-left-line="735" data-right-line="542"><a>735</a>                             a_loop      = trig_times_vec(k);                     .                             a_loop      = trig_times_vec(k);                     <span><a>542</a></span></span>
<span class="nodiff" data-left-line="736" data-right-line="543"><a>736</a>                             b_loop      = trig_times_vec(k+1);                   .                             b_loop      = trig_times_vec(k+1);                   <span><a>543</a></span></span>
<span class="nodiff" data-left-line="737" data-right-line="544"><a>737</a>                             a_dash_loop = trig_times_vec((j-1)*p.stim_frames + k .                             a_dash_loop = trig_times_vec((j-1)*p.stim_frames + k <span><a>544</a></span></span>
<span class="nodiff" data-left-line="738" data-right-line="545"><a>738</a>                             b_dash_loop = trig_times_vec((j-1)*p.stim_frames + k .                             b_dash_loop = trig_times_vec((j-1)*p.stim_frames + k <span><a>545</a></span></span>
<div id="diff66"><span class="diffLine" data-left-line="739" data-right-line="546"><a>739</a> <span class="diffnomatch">                            spike_times_vec_loop(indices_loop) = a_loop + (spike x                             <span style="background: #be96c6;">%</span>spike_times_vec_loop(indices_loop) = a_loop + (spik</span> <span><a>546</a></span></span>
</div><span class="nodiff" data-left-line="740" data-right-line="547"><a>740</a>                         end                                                      .                         end                                                      <span><a>547</a></span></span>
<div id="diff67"><span class="diffLine" data-left-line="740" data-right-line="548"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                         spike_times_vec_loop(indices_loop) = a_loop + (spike_tim</span> <span><a>548</a></span></span>
</div><span class="nodiff" data-left-line="741" data-right-line="549"><a>741</a>                     end                                                          .                     end                                                          <span><a>549</a></span></span>
<div id="diff68"><span class="diffLine" data-left-line="742" data-right-line="549"><a>742</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="743" data-right-line="550"><a>743</a>                 end                                                              .                 end                                                              <span><a>550</a></span></span>
<div id="diff69"><span class="diffLine" data-left-line="743" data-right-line="551"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                 % Map spike in interval after last stimulus window % PAR Mod 17,</span> <span><a>551</a></span></span>
<span class="diffLine" data-left-line="743" data-right-line="552"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                 indices_loop = find((spike_times_vec_loop&gt;trig_times_vec(p.Num_t</span> <span><a>552</a></span></span>
<span class="diffLine" data-left-line="743" data-right-line="553"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                                    &amp;(spike_times_vec_loop&lt;trig_times_vec(p.Num_t</span> <span><a>553</a></span></span>
<span class="diffLine" data-left-line="743" data-right-line="554"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                 a_loop      = trig_times_vec(Num_Trig_Final_NoiseChunk+1); % (NB</span> <span><a>554</a></span></span>
<span class="diffLine" data-left-line="743" data-right-line="555"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                 b_loop      = trig_times_vec(Num_Trig_Final_NoiseChunk+2); % (NB</span> <span><a>555</a></span></span>
<span class="diffLine" data-left-line="743" data-right-line="556"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                 a_dash_loop = trig_times_vec(p.Num_trigs) + stim_int;           </span> <span><a>556</a></span></span>
<span class="diffLine" data-left-line="743" data-right-line="557"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                 b_dash_loop = trig_times_vec(p.Num_trigs) + min_end_int;        </span> <span><a>557</a></span></span>
<span class="diffLine" data-left-line="743" data-right-line="558"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                 spike_times_vec_loop(indices_loop) = a_loop + (spike_times_vec_l</span> <span><a>558</a></span></span>
</div><span class="nodiff" data-left-line="744" data-right-line="559"><a>744</a>                                                                                  .                                                                                  <span><a>559</a></span></span>
<span class="nodiff" data-left-line="745" data-right-line="560"><a>745</a>             else % If there are gaps between (any) frozen noise chuncks          .             else % If there are gaps between (any) frozen noise chuncks          <span><a>560</a></span></span>
<span class="nodiff" data-left-line="746" data-right-line="561"><a>746</a>                                                                                  .                                                                                  <span><a>561</a></span></span>
<div id="diff70"><span class="diffLine" data-left-line="746" data-right-line="562"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                 if (Num_Trig_Final_NoiseChunk &gt;= p.Num_STE_bins + 1) || (Num_Tri</span> <span><a>562</a></span></span>
<span class="diffLine" data-left-line="747" data-right-line="563"><a>747</a> <span class="diffnomatch"><span style="background: #be96c6;">                </span>for j = 1:p.Num_FNoise_rep_ceil-1 % remove spikes with stimulus  x <span style="background: #be96c6;">                    </span>for j = 1:p.Num_FNoise_rep_ceil-1 % remove spikes with stimu</span> <span><a>563</a></span></span>
<span class="diffLine" data-left-line="748" data-right-line="564"><a>748</a> <span class="diffnomatch"><span style="background: #be96c6;">                    </span>spike_times_vec_loop((spike_times_vec_loop&gt;(trig_times_vec(j x <span style="background: #be96c6;">                        </span>spike_times_vec_loop((spike_times_vec_loop&gt;(trig_times_v</span> <span><a>564</a></span></span>
<span class="diffLine" data-left-line="749" data-right-line="565"><a>749</a> <span class="diffnomatch"><span style="background: #be96c6;">                </span>end                                                              x <span style="background: #be96c6;">                    </span>end                                                         </span> <span><a>565</a></span></span>
<span class="diffLine" data-left-line="749" data-right-line="566"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                 elseif p.Num_FNoise_rep_ceil&gt;2 % still need to remove spike betw</span> <span><a>566</a></span></span>
<span class="diffLine" data-left-line="749" data-right-line="567"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                     for j = 1:p.Num_FNoise_rep_ceil-2 % remove spikes with stimu</span> <span><a>567</a></span></span>
<span class="diffLine" data-left-line="749" data-right-line="568"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                         spike_times_vec_loop((spike_times_vec_loop&gt;(trig_times_v</span> <span><a>568</a></span></span>
<span class="diffLine" data-left-line="749" data-right-line="569"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                     end                                                         </span> <span><a>569</a></span></span>
<span class="diffLine" data-left-line="749" data-right-line="570"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                 end                                                             </span> <span><a>570</a></span></span>
</div><span class="nodiff" data-left-line="750" data-right-line="571"><a>750</a>                                                                                  .                                                                                  <span><a>571</a></span></span>
<span class="nodiff" data-left-line="751" data-right-line="572"><a>751</a>                 for j = 2:p.Num_FNoise_rep_ceil % map spikes in repeated stimulu .                 for j = 2:p.Num_FNoise_rep_ceil % map spikes in repeated stimulu <span><a>572</a></span></span>
<span class="nodiff" data-left-line="752" data-right-line="573"><a>752</a>                                                                                  .                                                                                  <span><a>573</a></span></span>
                                                                       <span class="diffskip">[3 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="756" data-right-line="577"><a>756</a>                         frame_end_loop = p.stim_frames;                          .                         frame_end_loop = p.stim_frames;                          <span><a>577</a></span></span>
<span class="nodiff" data-left-line="757" data-right-line="578"><a>757</a>                     end                                                          .                     end                                                          <span><a>578</a></span></span>
<span class="nodiff" data-left-line="758" data-right-line="579"><a>758</a>                                                                                  .                                                                                  <span><a>579</a></span></span>
<div id="diff71"><span class="diffLine" data-left-line="759" data-right-line="580"><a>759</a> <span class="diffnomatch">                    for k = 1:frame_end_loop                                     x                     for k = 1:frame_end_loop<span style="background: #be96c6;">+1 % PAR Mod 17,09,2020 (was 1:frame</span></span> <span><a>580</a></span></span>
</div><span class="nodiff" data-left-line="760" data-right-line="581"><a>760</a>                         if k&lt;frame_end_loop % frame_end_loop&lt;p.stim_frames       .                         if k&lt;frame_end_loop % frame_end_loop&lt;p.stim_frames       <span><a>581</a></span></span>
<div id="diff72"><span class="diffLine" data-left-line="761" data-right-line="582"><a>761</a> <span class="diffnomatch">                            indices_loop = find((spike_times_vec_loop&gt;trig_times x                             indices_loop = find((spike_times_vec_loop&gt;trig_times</span> <span><a>582</a></span></span>
</div><span class="nodiff" data-left-line="762" data-right-line="583"><a>762</a>                             a_loop      = trig_times_vec(k);                     .                             a_loop      = trig_times_vec(k);                     <span><a>583</a></span></span>
<span class="nodiff" data-left-line="763" data-right-line="584"><a>763</a>                             b_loop      = trig_times_vec(k+1);                   .                             b_loop      = trig_times_vec(k+1);                   <span><a>584</a></span></span>
<span class="nodiff" data-left-line="764" data-right-line="585"><a>764</a>                             a_dash_loop = trig_times_vec((j-1)*p.stim_frames + k .                             a_dash_loop = trig_times_vec((j-1)*p.stim_frames + k <span><a>585</a></span></span>
<span class="nodiff" data-left-line="765" data-right-line="586"><a>765</a>                             b_dash_loop = trig_times_vec((j-1)*p.stim_frames + k .                             b_dash_loop = trig_times_vec((j-1)*p.stim_frames + k <span><a>586</a></span></span>
<div id="diff73"><span class="diffLine" data-left-line="766" data-right-line="587"><a>766</a> <span class="diffnomatch">                            spike_times_vec_loop(indices_loop) = a_loop + (spike x                             <span style="background: #be96c6;">%</span>spike_times_vec_loop(indices_loop) = a_loop + (spik</span> <span><a>587</a></span></span>
<span class="diffLine" data-left-line="767" data-right-line="588"><a>767</a> <span class="diffnomatch">                        <span style="background: #be96c6;">else % </span>k==frame_end_loop % <span style="background: #be96c6;">frame_end_loop==p.stim_frames</span> x                         <span style="background: #be96c6;">elseif  </span>k==frame_end_loop % No end time is given for the</span> <span><a>588</a></span></span>
<span class="diffLine" data-left-line="768" data-right-line="589"><a>768</a> <span class="diffnomatch">                            indices_loop = find((spike_times_vec_loop&gt;trig_times x                             indices_loop = find((spike_times_vec_loop&gt;trig_times</span> <span><a>589</a></span></span>
</div><span class="nodiff" data-left-line="769" data-right-line="590"><a>769</a>                             a_loop      = trig_times_vec(k);                     .                             a_loop      = trig_times_vec(k);                     <span><a>590</a></span></span>
<div id="diff74"><span class="diffLine" data-left-line="770" data-right-line="591"><a>770</a> <span class="diffnomatch">                            b_loop      = trig_times_vec(k+1)<span style="background: #be96c6;">;</span>                   x                             b_loop      = trig_times_vec(k<span style="background: #be96c6;">) </span>+<span style="background: #be96c6;"> stim_int; % PAR Mo</span></span> <span><a>591</a></span></span>
</div><span class="nodiff" data-left-line="771" data-right-line="592"><a>771</a>                             a_dash_loop = trig_times_vec((j-1)*p.stim_frames + k .                             a_dash_loop = trig_times_vec((j-1)*p.stim_frames + k <span><a>592</a></span></span>
<span class="nodiff" data-left-line="772" data-right-line="593"><a>772</a>                             b_dash_loop = trig_times_vec((j-1)*p.stim_frames + k .                             b_dash_loop = trig_times_vec((j-1)*p.stim_frames + k <span><a>593</a></span></span>
<div id="diff75"><span class="diffLine" data-left-line="773" data-right-line="594"><a>773</a> <span class="diffnomatch">                            spike_times_vec_loop(indices_loop) = a_loop + (spike x                             <span style="background: #be96c6;">%</span>spike_times_vec_loop(indices_loop) = a_loop + (spik</span> <span><a>594</a></span></span>
<span class="diffLine" data-left-line="773" data-right-line="595"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                         else % k==frame_end_loop+1 % PAR Mod 17,09,2020 (everyth</span> <span><a>595</a></span></span>
<span class="diffLine" data-left-line="773" data-right-line="596"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                             indices_loop = find((spike_times_vec_loop&gt;trig_times</span> <span><a>596</a></span></span>
<span class="diffLine" data-left-line="773" data-right-line="597"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                                                &amp;(spike_times_vec_loop&lt;trig_times</span> <span><a>597</a></span></span>
<span class="diffLine" data-left-line="773" data-right-line="598"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                             if frame_end_loop == p.stim_frames                  </span> <span><a>598</a></span></span>
<span class="diffLine" data-left-line="773" data-right-line="599"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                                 a_loop      = trig_times_vec(p.stim_frames) + st</span> <span><a>599</a></span></span>
<span class="diffLine" data-left-line="773" data-right-line="600"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                                 b_loop      = trig_times_vec(p.stim_frames) + mi</span> <span><a>600</a></span></span>
<span class="diffLine" data-left-line="773" data-right-line="601"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                                 a_dash_loop = trig_times_vec(j*p.stim_frames) + </span> <span><a>601</a></span></span>
<span class="diffLine" data-left-line="773" data-right-line="602"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                                 b_dash_loop = trig_times_vec(j*p.stim_frames) + </span> <span><a>602</a></span></span>
<span class="diffLine" data-left-line="773" data-right-line="603"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                             else %frame_end_loop &lt; p.stim_frames                </span> <span><a>603</a></span></span>
<span class="diffLine" data-left-line="773" data-right-line="604"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                                 a_loop      = trig_times_vec(k);                </span> <span><a>604</a></span></span>
<span class="diffLine" data-left-line="773" data-right-line="605"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                                 b_loop      = trig_times_vec(k+1);              </span> <span><a>605</a></span></span>
<span class="diffLine" data-left-line="773" data-right-line="606"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                                 a_dash_loop = trig_times_vec((j-1)*p.stim_frames</span> <span><a>606</a></span></span>
<span class="diffLine" data-left-line="773" data-right-line="607"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                                 b_dash_loop = trig_times_vec((j-1)*p.stim_frames</span> <span><a>607</a></span></span>
<span class="diffLine" data-left-line="774" data-right-line="608"><a>774</a> <span class="diffnomatch"><span style="background: #be96c6;">                        </span>end                                                      x <span style="background: #be96c6;">                            </span>end                                                 </span> <span><a>608</a></span></span>
<span class="diffLine" data-left-line="775" data-right-line="609"><a>775</a> <span class="diffnomatch"><span style="background: #be96c6;">                    </span>end                                                          x <span style="background: #be96c6;">                        </span>end                                                     </span> <span><a>609</a></span></span>
<span class="diffLine" data-left-line="775" data-right-line="610"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                         spike_times_vec_loop(indices_loop) = a_loop + (spike_tim</span> <span><a>610</a></span></span>
<span class="diffLine" data-left-line="775" data-right-line="611"><span class="diffsoft">  -</span><span class="diffold">                                                                                 </span><span class="diffnew right"> &gt;                     end                                                         </span> <span><a>611</a></span></span>
</div><span class="nodiff" data-left-line="776" data-right-line="612"><a>776</a>                                                                                  .                                                                                  <span><a>612</a></span></span>
<span class="nodiff" data-left-line="777" data-right-line="613"><a>777</a>                 end                                                              .                 end                                                              <span><a>613</a></span></span>
<span class="nodiff" data-left-line="778" data-right-line="614"><a>778</a>                                                                                  .                                                                                  <span><a>614</a></span></span>
                                                                       <span class="diffskip">[4 unmodified lines hidden]</span>
<span class="nodiff" data-left-line="783" data-right-line="619"><a>783</a>         %p.length_spike_times      = length(spike_times_vec_loop);               .         %p.length_spike_times      = length(spike_times_vec_loop);               <span><a>619</a></span></span>
<span class="nodiff" data-left-line="784" data-right-line="620"><a>784</a>         length_spike_times_loop   = length(spike_times_vec_loop); % To allow par .         length_spike_times_loop   = length(spike_times_vec_loop); % To allow par <span><a>620</a></span></span>
<span class="nodiff" data-left-line="785" data-right-line="621"><a>785</a>                                                                                  .                                                                                  <span><a>621</a></span></span>
<div id="diff76"><span class="diffLine" data-left-line="786" data-right-line="622"><a>786</a> <span class="diffnomatch">        RF_Ident<span style="background: #be96c6;">(</span>i<span style="background: #be96c6;">).RF_results</span> = RF_Ident_fn_v6(stimulus_arr,trig_times_vec_trun x         RF_Ident<span style="background: #be96c6;">{</span>i<span style="background: #be96c6;">}</span> = RF_Ident_fn_v6(stimulus_arr,trig_times_vec_trunc,spike_tim</span> <span><a>622</a></span></span>
<span class="diffLine" data-left-line="787" data-right-line="622"><a>787</a> <span class="diffnew left">        RF_Ident(i).cell_idx = cell_indices_temp(i);                             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="788" data-right-line="623"><a>788</a>                                                                                  .                                                                                  <span><a>623</a></span></span>
<div id="diff77"><span class="diffLine" data-left-line="789" data-right-line="624"><a>789</a> <span class="diffnomatch">        <span style="background: #be96c6;">%Add info if first cell</span>                                                  x         <span style="background: #be96c6;">disp(i);</span>                                                                </span> <span><a>624</a></span></span>
</div><span class="nodiff" data-left-line="790" data-right-line="625"><a>790</a>                                                                                  .                                                                                  <span><a>625</a></span></span>
<div id="diff78"><span class="diffLine" data-left-line="791" data-right-line="625"><a>791</a> <span class="diffnew left">        RF_Ident(i).add_info = add_info.settings.kernel_new;                     &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="792" data-right-line="625"><a>792</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="793" data-right-line="625"><a>793</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="794" data-right-line="625"><a>794</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="795" data-right-line="626"><a>795</a>     end                                                                          .     end                                                                          <span><a>626</a></span></span>
<span class="nodiff" data-left-line="796" data-right-line="627"><a>796</a>                                                                                  .                                                                                  <span><a>627</a></span></span>
<span class="nodiff" data-left-line="797" data-right-line="628"><a>797</a> end                                                                              . end                                                                              <span><a>628</a></span></span>
<div id="diff79"><span class="diffLine" data-left-line="798" data-right-line="628"><a>798</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="799" data-right-line="628"><a>799</a> <span class="diffnew left">%Add some extra info                                                             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="800" data-right-line="628"><a>800</a> <span class="diffnew left">%Check if RF was found                                                           &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="801" data-right-line="628"><a>801</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="802" data-right-line="628"><a>802</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="803" data-right-line="628"><a>803</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="804" data-right-line="628"><a>804</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="805" data-right-line="628"><a>805</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="806" data-right-line="628"><a>806</a> <span class="diffnew left">%% Data organization and saving                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="807" data-right-line="628"><a>807</a> <span class="diffnew left">%We have 2 x 2 conditions:                                                       &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="808" data-right-line="628"><a>808</a> <span class="diffnew left">%STASD - SDThreshold, STASD - Confidence Interval                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="809" data-right-line="628"><a>809</a> <span class="diffnew left">%SelfCovariance - SDThreshold, SelfCovaricance - Confidence Interval             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="810" data-right-line="628"><a>810</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="811" data-right-line="628"><a>811</a> <span class="diffnew left">%We need to save these independently, so it doesnt get overwritten when the      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="812" data-right-line="628"><a>812</a> <span class="diffnew left">%repective other QC Type is choosen.                                             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="813" data-right-line="628"><a>813</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="814" data-right-line="628"><a>814</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="815" data-right-line="628"><a>815</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="816" data-right-line="628"><a>816</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="817" data-right-line="628"><a>817</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="818" data-right-line="628"><a>818</a> <span class="diffnew left">if add_info.settings.kernel_new.SS_Std                                           &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="819" data-right-line="628"><a>819</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="820" data-right-line="628"><a>820</a> <span class="diffnew left">    %Saving the RF info                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="821" data-right-line="628"><a>821</a> <span class="diffnew left">    subfoldername = ['RF_Ident_SS_Std_Thr_',num2str(add_info.settings.kernel_new &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="822" data-right-line="628"><a>822</a> <span class="diffnew left">    save_folder = sf_organizer(stim_idx,savepath,'subfoldername',subfoldername); &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="823" data-right-line="628"><a>823</a> <span class="diffnew left">    f = waitbar(0,'Saving files, file:');                                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="824" data-right-line="628"><a>824</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="825" data-right-line="628"><a>825</a> <span class="diffnew left">    for rf = 1:length(RF_Ident)                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="826" data-right-line="628"><a>826</a> <span class="diffnew left">        if isstruct(RF_Ident(rf).RF_results)                                     &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="827" data-right-line="628"><a>827</a> <span class="diffnew left">         waitbar(rf/length(RF_Ident),f,['Saving files, file: ',num2str(rf)])     &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="828" data-right-line="628"><a>828</a> <span class="diffnew left">         RF_overview(rf).file = strcat(save_folder,'\RF_Ident_',num2str(cell_ind &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="829" data-right-line="628"><a>829</a> <span class="diffnew left">         fileID = fopen(strcat(save_folder,'\RF_Ident_',num2str(cell_indices_tem &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="830" data-right-line="628"><a>830</a> <span class="diffnew left">         fwrite(fileID,hlp_serialize(RF_Ident(rf)));                             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="831" data-right-line="628"><a>831</a> <span class="diffnew left">         fclose(fileID);                                                         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="832" data-right-line="628"><a>832</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="833" data-right-line="628"><a>833</a> <span class="diffnew left">%          save_location = sf_organizer(stim_idx,savepath,'subfoldername',subfol &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="834" data-right-line="628"><a>834</a> <span class="diffnew left">%                 'variable_name',['RF_Ident_',num2str(cell_indices_temp(rf))]); &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="835" data-right-line="628"><a>835</a> <span class="diffnew left">    end                                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="836" data-right-line="628"><a>836</a> <span class="diffnew left">    try                                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="837" data-right-line="628"><a>837</a> <span class="diffnew left">        close(f)                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="838" data-right-line="628"><a>838</a> <span class="diffnew left">    catch                                                                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="839" data-right-line="628"><a>839</a> <span class="diffnew left">        continue                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="840" data-right-line="628"><a>840</a> <span class="diffnew left">    end                                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="841" data-right-line="628"><a>841</a> <span class="diffnew left">    [~] = sf_organizer(stim_idx,savepath,'subfoldername',subfoldername,'collect_ &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="842" data-right-line="628"><a>842</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="843" data-right-line="628"><a>843</a> <span class="diffnew left">    %Check for Gaussian RF                                                       &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="844" data-right-line="628"><a>844</a> <span class="diffnew left">    for i = 1:length(RF_Ident)                                                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="845" data-right-line="628"><a>845</a> <span class="diffnew left">        try                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="846" data-right-line="628"><a>846</a> <span class="diffnew left">            if RF_Ident(i).RF_results.STASD_Gaus_FullRF_Num_pixels &gt;= 1          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="847" data-right-line="628"><a>847</a> <span class="diffnew left">                RF_overview(i).STASD_Gaus_RF = true;                             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="848" data-right-line="628"><a>848</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="849" data-right-line="628"><a>849</a> <span class="diffnew left">            else                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="850" data-right-line="628"><a>850</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="851" data-right-line="628"><a>851</a> <span class="diffnew left">                RF_overview(i).STASD_Gaus_RF = false;                            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="852" data-right-line="628"><a>852</a> <span class="diffnew left">            end                                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="853" data-right-line="628"><a>853</a> <span class="diffnew left">        catch                                                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="854" data-right-line="628"><a>854</a> <span class="diffnew left">            RF_overview(i).STASD_Gaus_RF = false;                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="855" data-right-line="628"><a>855</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="856" data-right-line="628"><a>856</a> <span class="diffnew left">    %Check for ASP RF                                                            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="857" data-right-line="628"><a>857</a> <span class="diffnew left">        try                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="858" data-right-line="628"><a>858</a> <span class="diffnew left">            if RF_Ident(i).RF_results.STASD_ASP_FullRF_Num_pixels &gt;= 1           &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="859" data-right-line="628"><a>859</a> <span class="diffnew left">                RF_overview(i).STASD_ASP_RF = true;                              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="860" data-right-line="628"><a>860</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="861" data-right-line="628"><a>861</a> <span class="diffnew left">            else                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="862" data-right-line="628"><a>862</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="863" data-right-line="628"><a>863</a> <span class="diffnew left">                RF_overview(i).STASD_ASP_RF = false;                             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="864" data-right-line="628"><a>864</a> <span class="diffnew left">            end                                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="865" data-right-line="628"><a>865</a> <span class="diffnew left">        catch                                                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="866" data-right-line="628"><a>866</a> <span class="diffnew left">            RF_overview(i).STASD_ASP_RF = false;                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="867" data-right-line="628"><a>867</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="868" data-right-line="628"><a>868</a> <span class="diffnew left">     %Check for Box RF                                                           &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="869" data-right-line="628"><a>869</a> <span class="diffnew left">        try                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="870" data-right-line="628"><a>870</a> <span class="diffnew left">            if RF_Ident(i).RF_results.STASD_Box_FullRF_Num_pixels &gt;= 1           &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="871" data-right-line="628"><a>871</a> <span class="diffnew left">                RF_overview(i).STASD_Box_RF = true;                              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="872" data-right-line="628"><a>872</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="873" data-right-line="628"><a>873</a> <span class="diffnew left">            else                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="874" data-right-line="628"><a>874</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="875" data-right-line="628"><a>875</a> <span class="diffnew left">                RF_overview(i).STASD_Box_RF = false;                             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="876" data-right-line="628"><a>876</a> <span class="diffnew left">            end                                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="877" data-right-line="628"><a>877</a> <span class="diffnew left">        catch                                                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="878" data-right-line="628"><a>878</a> <span class="diffnew left">            RF_overview(i).STASD_Box_RF = false;                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="879" data-right-line="628"><a>879</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="880" data-right-line="628"><a>880</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="881" data-right-line="628"><a>881</a> <span class="diffnew left">        RF_overview(i).cell_idx = cell_indices_temp(i);                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="882" data-right-line="628"><a>882</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="883" data-right-line="628"><a>883</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="884" data-right-line="628"><a>884</a> <span class="diffnew left">    end                                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="885" data-right-line="628"><a>885</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="886" data-right-line="628"><a>886</a> <span class="diffnew left">    if bb == 1                                                                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="887" data-right-line="628"><a>887</a> <span class="diffnew left">        save_location = sf_organizer(stim_idx,savepath,'subfoldername',subfolder &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="888" data-right-line="628"><a>888</a> <span class="diffnew left">            'variable_name','RF_overview');                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="889" data-right-line="628"><a>889</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="890" data-right-line="628"><a>890</a> <span class="diffnew left">    else                                                                         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="891" data-right-line="628"><a>891</a> <span class="diffnew left">            %Create matfile and attach files to existing batch                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="892" data-right-line="628"><a>892</a> <span class="diffnew left">        M = matfile(save_location,'Writable',true);                              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="893" data-right-line="628"><a>893</a> <span class="diffnew left">        M.RF_overview(1,batch_begins(bb):batch_ends(bb)) = RF_overview;          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="894" data-right-line="628"><a>894</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="895" data-right-line="628"><a>895</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="896" data-right-line="628"><a>896</a> <span class="diffnew left">    end                                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="897" data-right-line="628"><a>897</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="898" data-right-line="628"><a>898</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="899" data-right-line="628"><a>899</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="900" data-right-line="628"><a>900</a> <span class="diffnew left">elseif add_info.settings.kernel_new.SS_CI                                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="901" data-right-line="628"><a>901</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="902" data-right-line="628"><a>902</a> <span class="diffnew left">    %Saving the RF info                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="903" data-right-line="628"><a>903</a> <span class="diffnew left">    subfoldername = ['RF_Ident_SS_CI_Thr_',num2str(add_info.settings.kernel_new. &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="904" data-right-line="628"><a>904</a> <span class="diffnew left">    save_folder = sf_organizer(stim_idx,savepath,'subfoldername',subfoldername); &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="905" data-right-line="628"><a>905</a> <span class="diffnew left">    f = waitbar(0,'Saving files, file:');                                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="906" data-right-line="628"><a>906</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="907" data-right-line="628"><a>907</a> <span class="diffnew left">    for rf = 1:length(RF_Ident)                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="908" data-right-line="628"><a>908</a> <span class="diffnew left">        if isstruct(RF_Ident(rf).RF_results)                                     &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="909" data-right-line="628"><a>909</a> <span class="diffnew left">         waitbar(rf/length(RF_Ident),f,['Saving files, file: ',num2str(rf)])     &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="910" data-right-line="628"><a>910</a> <span class="diffnew left">         RF_overview(rf).file = strcat(save_folder,'\RF_Ident_',num2str(cell_ind &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="911" data-right-line="628"><a>911</a> <span class="diffnew left">         fileID = fopen(strcat(save_folder,'\RF_Ident_',num2str(cell_indices_tem &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="912" data-right-line="628"><a>912</a> <span class="diffnew left">         fwrite(fileID,hlp_serialize(RF_Ident(rf)));                             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="913" data-right-line="628"><a>913</a> <span class="diffnew left">         fclose(fileID);                                                         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="914" data-right-line="628"><a>914</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="915" data-right-line="628"><a>915</a> <span class="diffnew left">%          save_location = sf_organizer(stim_idx,savepath,'subfoldername',subfol &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="916" data-right-line="628"><a>916</a> <span class="diffnew left">%                 'variable_name',['RF_Ident_',num2str(cell_indices_temp(rf))]); &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="917" data-right-line="628"><a>917</a> <span class="diffnew left">    end                                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="918" data-right-line="628"><a>918</a> <span class="diffnew left">    save_folder = sf_organizer(stim_idx,savepath,'subfoldername',subfoldername,' &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="919" data-right-line="628"><a>919</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="920" data-right-line="628"><a>920</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="921" data-right-line="628"><a>921</a> <span class="diffnew left">    %Check for Gaussian RF                                                       &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="922" data-right-line="628"><a>922</a> <span class="diffnew left">    for i = 1:stx                                                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="923" data-right-line="628"><a>923</a> <span class="diffnew left">        try                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="924" data-right-line="628"><a>924</a> <span class="diffnew left">            if RF_Ident(i).RF_results.STASD_Gaus_FullRF_Num_pixels &gt;= 1          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="925" data-right-line="628"><a>925</a> <span class="diffnew left">                RF_overview(i).STASD_Gaus_RF = true;                             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="926" data-right-line="628"><a>926</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="927" data-right-line="628"><a>927</a> <span class="diffnew left">            else                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="928" data-right-line="628"><a>928</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="929" data-right-line="628"><a>929</a> <span class="diffnew left">                RF_overview(i).STASD_Gaus_RF = false;                            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="930" data-right-line="628"><a>930</a> <span class="diffnew left">            end                                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="931" data-right-line="628"><a>931</a> <span class="diffnew left">        catch                                                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="932" data-right-line="628"><a>932</a> <span class="diffnew left">            RF_overview(i).STASD_Gaus_RF = false;                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="933" data-right-line="628"><a>933</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="934" data-right-line="628"><a>934</a> <span class="diffnew left">    %Check for ASP RF                                                            &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="935" data-right-line="628"><a>935</a> <span class="diffnew left">        try                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="936" data-right-line="628"><a>936</a> <span class="diffnew left">            if RF_Ident(i).RF_results.STASD_ASP_FullRF_Num_pixels &gt;= 1           &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="937" data-right-line="628"><a>937</a> <span class="diffnew left">                RF_overview(i).STASD_ASP_RF = true;                              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="938" data-right-line="628"><a>938</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="939" data-right-line="628"><a>939</a> <span class="diffnew left">            else                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="940" data-right-line="628"><a>940</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="941" data-right-line="628"><a>941</a> <span class="diffnew left">                RF_overview(i).STASD_ASP_RF = false;                             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="942" data-right-line="628"><a>942</a> <span class="diffnew left">            end                                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="943" data-right-line="628"><a>943</a> <span class="diffnew left">        catch                                                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="944" data-right-line="628"><a>944</a> <span class="diffnew left">            RF_overview(i).STASD_ASP_RF = false;                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="945" data-right-line="628"><a>945</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="946" data-right-line="628"><a>946</a> <span class="diffnew left">     %Check for Box RF                                                           &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="947" data-right-line="628"><a>947</a> <span class="diffnew left">        try                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="948" data-right-line="628"><a>948</a> <span class="diffnew left">            if RF_Ident(i).RF_results.STASD_Box_FullRF_Num_pixels &gt;= 1           &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="949" data-right-line="628"><a>949</a> <span class="diffnew left">                RF_overview(i).STASD_Box_RF = true;                              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="950" data-right-line="628"><a>950</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="951" data-right-line="628"><a>951</a> <span class="diffnew left">            else                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="952" data-right-line="628"><a>952</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="953" data-right-line="628"><a>953</a> <span class="diffnew left">                RF_overview(i).STASD_Box_RF = false;                             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="954" data-right-line="628"><a>954</a> <span class="diffnew left">            end                                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="955" data-right-line="628"><a>955</a> <span class="diffnew left">        catch                                                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="956" data-right-line="628"><a>956</a> <span class="diffnew left">            RF_overview(i).STASD_Box_RF = false;                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="957" data-right-line="628"><a>957</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="958" data-right-line="628"><a>958</a> <span class="diffnew left">        RF_overview(i).cell_idx = cell_indices_temp(i);                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="959" data-right-line="628"><a>959</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="960" data-right-line="628"><a>960</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="961" data-right-line="628"><a>961</a> <span class="diffnew left">    end                                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="962" data-right-line="628"><a>962</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="963" data-right-line="628"><a>963</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="964" data-right-line="628"><a>964</a> <span class="diffnew left">    if bb == 1                                                                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="965" data-right-line="628"><a>965</a> <span class="diffnew left">        save_location = sf_organizer(stim_idx,savepath,'subfoldername',subfolder &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="966" data-right-line="628"><a>966</a> <span class="diffnew left">            'variable_name','RF_overview');                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="967" data-right-line="628"><a>967</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="968" data-right-line="628"><a>968</a> <span class="diffnew left">    else                                                                         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="969" data-right-line="628"><a>969</a> <span class="diffnew left">            %Create matfile and attach files to existing batch                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="970" data-right-line="628"><a>970</a> <span class="diffnew left">        M = matfile(save_location,'Writable',true);                              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="971" data-right-line="628"><a>971</a> <span class="diffnew left">        M.RF_overview(1,batch_begins(bb):batch_ends(bb)) = RF_overview;          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="972" data-right-line="628"><a>972</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="973" data-right-line="628"><a>973</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="974" data-right-line="628"><a>974</a> <span class="diffnew left">    end                                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="975" data-right-line="628"><a>975</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="976" data-right-line="628"><a>976</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="977" data-right-line="628"><a>977</a> <span class="diffnew left">elseif add_info.settings.kernel_new.SC_Std                                       &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="978" data-right-line="628"><a>978</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="979" data-right-line="628"><a>979</a> <span class="diffnew left">    subfoldername = ['RF_Ident_SC_Std_Thr_',num2str(add_info.settings.kernel_new &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="980" data-right-line="628"><a>980</a> <span class="diffnew left">    save_folder = sf_organizer(stim_idx,savepath,'subfoldername',subfoldername); &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="981" data-right-line="628"><a>981</a> <span class="diffnew left">    f = waitbar(0,'Saving files, file:');                                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="982" data-right-line="628"><a>982</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="983" data-right-line="628"><a>983</a> <span class="diffnew left">    for rf = 1:length(RF_Ident)                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="984" data-right-line="628"><a>984</a> <span class="diffnew left">        if isstruct(RF_Ident(rf).RF_results)                                     &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="985" data-right-line="628"><a>985</a> <span class="diffnew left">         waitbar(rf/length(RF_Ident),f,['Saving files, file: ',num2str(rf)])     &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="986" data-right-line="628"><a>986</a> <span class="diffnew left">         RF_overview(rf).file = strcat(save_folder,'\RF_Ident_',num2str(cell_ind &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="987" data-right-line="628"><a>987</a> <span class="diffnew left">         fileID = fopen(strcat(save_folder,'\RF_Ident_',num2str(cell_indices_tem &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="988" data-right-line="628"><a>988</a> <span class="diffnew left">         fwrite(fileID,hlp_serialize(RF_Ident(rf)));                             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="989" data-right-line="628"><a>989</a> <span class="diffnew left">         fclose(fileID);                                                         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="990" data-right-line="628"><a>990</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="991" data-right-line="628"><a>991</a> <span class="diffnew left">%          save_location = sf_organizer(stim_idx,savepath,'subfoldername',subfol &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="992" data-right-line="628"><a>992</a> <span class="diffnew left">%                 'variable_name',['RF_Ident_',num2str(cell_indices_temp(rf))]); &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="993" data-right-line="628"><a>993</a> <span class="diffnew left">    end                                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="994" data-right-line="628"><a>994</a> <span class="diffnew left">    save_folder = sf_organizer(stim_idx,savepath,'subfoldername',subfoldername,' &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="995" data-right-line="628"><a>995</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="996" data-right-line="628"><a>996</a> <span class="diffnew left">    for i = 1:stx                                                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="997" data-right-line="628"><a>997</a> <span class="diffnew left">        %Check for Gaussian RF                                                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="998" data-right-line="628"><a>998</a> <span class="diffnew left">        try                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="999" data-right-line="628"><a>999</a> <span class="diffnew left">            if RF_Ident(i).RF_results.SC_Gaus_FullRF_Num_pixels &gt;= 1             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1000" data-right-line="628"><a>1000</a> <span class="diffnew left">                RF_overview(i).SC_Gaus_RF = true;                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1001" data-right-line="628"><a>1001</a> <span class="diffnew left">            else                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1002" data-right-line="628"><a>1002</a> <span class="diffnew left">                RF_overview(i).SC_Gaus_RF = false;                               &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1003" data-right-line="628"><a>1003</a> <span class="diffnew left">            end                                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1004" data-right-line="628"><a>1004</a> <span class="diffnew left">        catch                                                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1005" data-right-line="628"><a>1005</a> <span class="diffnew left">            RF_overview(i).SC_Gaus_RF = false;                                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1006" data-right-line="628"><a>1006</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1007" data-right-line="628"><a>1007</a> <span class="diffnew left">        %Check for ASP RF                                                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1008" data-right-line="628"><a>1008</a> <span class="diffnew left">        try                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1009" data-right-line="628"><a>1009</a> <span class="diffnew left">            if RF_Ident(i).RF_results.SC_ASP_FullRF_Num_pixels &gt;= 1              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1010" data-right-line="628"><a>1010</a> <span class="diffnew left">                RF_overview(i).SC_ASP_RF = true;                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1011" data-right-line="628"><a>1011</a> <span class="diffnew left">            else                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1012" data-right-line="628"><a>1012</a> <span class="diffnew left">                RF_overview(i).SC_ASP_RF = false;                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1013" data-right-line="628"><a>1013</a> <span class="diffnew left">            end                                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1014" data-right-line="628"><a>1014</a> <span class="diffnew left">        catch                                                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1015" data-right-line="628"><a>1015</a> <span class="diffnew left">            RF_overview(i).SC_ASP_RF = false;                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1016" data-right-line="628"><a>1016</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1017" data-right-line="628"><a>1017</a> <span class="diffnew left">        %Check for Box RF                                                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1018" data-right-line="628"><a>1018</a> <span class="diffnew left">         try                                                                     &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1019" data-right-line="628"><a>1019</a> <span class="diffnew left">            if RF_Ident(i).RF_results.SC_Box_FullRF_Num_pixels &gt;= 1              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1020" data-right-line="628"><a>1020</a> <span class="diffnew left">                RF_overview(i).SC_Box_RF = true;                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1021" data-right-line="628"><a>1021</a> <span class="diffnew left">            else                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1022" data-right-line="628"><a>1022</a> <span class="diffnew left">                RF_overview(i).SC_Box_RF = false;                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1023" data-right-line="628"><a>1023</a> <span class="diffnew left">            end                                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1024" data-right-line="628"><a>1024</a> <span class="diffnew left">        catch                                                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1025" data-right-line="628"><a>1025</a> <span class="diffnew left">            RF_overview(i).SC_Box_RF = false;                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1026" data-right-line="628"><a>1026</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1027" data-right-line="628"><a>1027</a> <span class="diffnew left">        RF_overview(i).cell_idx = cell_indices_temp(i);                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1028" data-right-line="628"><a>1028</a> <span class="diffnew left">    end                                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1029" data-right-line="628"><a>1029</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1030" data-right-line="628"><a>1030</a> <span class="diffnew left">    if bb == 1                                                                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1031" data-right-line="628"><a>1031</a> <span class="diffnew left">        save_location = sf_organizer(stim_idx,savepath,'subfoldername',subfolder &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1032" data-right-line="628"><a>1032</a> <span class="diffnew left">            'variable_name','RF_overview');                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1033" data-right-line="628"><a>1033</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1034" data-right-line="628"><a>1034</a> <span class="diffnew left">    else                                                                         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1035" data-right-line="628"><a>1035</a> <span class="diffnew left">            %Create matfile and attach files to existing batch                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1036" data-right-line="628"><a>1036</a> <span class="diffnew left">        M = matfile(save_location,'Writable',true);                              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1037" data-right-line="628"><a>1037</a> <span class="diffnew left">        M.RF_overview(1,batch_begins(bb):batch_ends(bb)) = RF_overview;          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1038" data-right-line="628"><a>1038</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1039" data-right-line="628"><a>1039</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1040" data-right-line="628"><a>1040</a> <span class="diffnew left">    end                                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1041" data-right-line="628"><a>1041</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1042" data-right-line="628"><a>1042</a> <span class="diffnew left">elseif add_info.settings.kernel_new.SC_CI                                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1043" data-right-line="628"><a>1043</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1044" data-right-line="628"><a>1044</a> <span class="diffnew left">    subfoldername = ['RF_Ident_SC_CI_Thr_',num2str(add_info.settings.kernel_new. &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1045" data-right-line="628"><a>1045</a> <span class="diffnew left">    save_folder = sf_organizer(stim_idx,savepath,'subfoldername',subfoldername); &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1046" data-right-line="628"><a>1046</a> <span class="diffnew left">    f = waitbar(0,'Saving files, file:');                                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1047" data-right-line="628"><a>1047</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1048" data-right-line="628"><a>1048</a> <span class="diffnew left">    for rf = 1:length(RF_Ident)                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1049" data-right-line="628"><a>1049</a> <span class="diffnew left">        if isstruct(RF_Ident(rf).RF_results)                                     &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1050" data-right-line="628"><a>1050</a> <span class="diffnew left">         waitbar(rf/length(RF_Ident),f,['Saving files, file: ',num2str(rf)])     &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1051" data-right-line="628"><a>1051</a> <span class="diffnew left">         RF_overview(rf).file = strcat(save_folder,'\RF_Ident_',num2str(cell_ind &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1052" data-right-line="628"><a>1052</a> <span class="diffnew left">         fileID = fopen(strcat(save_folder,'\RF_Ident_',num2str(cell_indices_tem &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1053" data-right-line="628"><a>1053</a> <span class="diffnew left">         fwrite(fileID,hlp_serialize(RF_Ident(rf)));                             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1054" data-right-line="628"><a>1054</a> <span class="diffnew left">         fclose(fileID);                                                         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1055" data-right-line="628"><a>1055</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1056" data-right-line="628"><a>1056</a> <span class="diffnew left">%          save_location = sf_organizer(stim_idx,savepath,'subfoldername',subfol &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1057" data-right-line="628"><a>1057</a> <span class="diffnew left">%                 'variable_name',['RF_Ident_',num2str(cell_indices_temp(rf))]); &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1058" data-right-line="628"><a>1058</a> <span class="diffnew left">    end                                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1059" data-right-line="628"><a>1059</a> <span class="diffnew left">    save_folder = sf_organizer(stim_idx,savepath,'subfoldername',subfoldername,' &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1060" data-right-line="628"><a>1060</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1061" data-right-line="628"><a>1061</a> <span class="diffnew left">    for i = 1:stx                                                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1062" data-right-line="628"><a>1062</a> <span class="diffnew left">        %Check for Gaussian RF                                                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1063" data-right-line="628"><a>1063</a> <span class="diffnew left">        try                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1064" data-right-line="628"><a>1064</a> <span class="diffnew left">            if RF_Ident(i).RF_results.SC_Gaus_FullRF_Num_pixels &gt;= 1             &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1065" data-right-line="628"><a>1065</a> <span class="diffnew left">                RF_overview(i).SC_Gaus_RF = true;                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1066" data-right-line="628"><a>1066</a> <span class="diffnew left">            else                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1067" data-right-line="628"><a>1067</a> <span class="diffnew left">                RF_overview(i).SC_Gaus_RF = false;                               &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1068" data-right-line="628"><a>1068</a> <span class="diffnew left">            end                                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1069" data-right-line="628"><a>1069</a> <span class="diffnew left">        catch                                                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1070" data-right-line="628"><a>1070</a> <span class="diffnew left">            RF_overview(i).SC_Gaus_RF = false;                                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1071" data-right-line="628"><a>1071</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1072" data-right-line="628"><a>1072</a> <span class="diffnew left">        %Check for ASP RF                                                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1073" data-right-line="628"><a>1073</a> <span class="diffnew left">        try                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1074" data-right-line="628"><a>1074</a> <span class="diffnew left">            if RF_Ident(i).RF_results.SC_ASP_FullRF_Num_pixels &gt;= 1              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1075" data-right-line="628"><a>1075</a> <span class="diffnew left">                RF_overview(i).SC_ASP_RF = true;                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1076" data-right-line="628"><a>1076</a> <span class="diffnew left">            else                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1077" data-right-line="628"><a>1077</a> <span class="diffnew left">                RF_overview(i).SC_ASP_RF = false;                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1078" data-right-line="628"><a>1078</a> <span class="diffnew left">            end                                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1079" data-right-line="628"><a>1079</a> <span class="diffnew left">        catch                                                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1080" data-right-line="628"><a>1080</a> <span class="diffnew left">            RF_overview(i).SC_ASP_RF = false;                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1081" data-right-line="628"><a>1081</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1082" data-right-line="628"><a>1082</a> <span class="diffnew left">        %Check for Box RF                                                        &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1083" data-right-line="628"><a>1083</a> <span class="diffnew left">         try                                                                     &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1084" data-right-line="628"><a>1084</a> <span class="diffnew left">            if RF_Ident(i).RF_results.SC_Box_FullRF_Num_pixels &gt;= 1              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1085" data-right-line="628"><a>1085</a> <span class="diffnew left">                RF_overview(i).SC_Box_RF = true;                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1086" data-right-line="628"><a>1086</a> <span class="diffnew left">            else                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1087" data-right-line="628"><a>1087</a> <span class="diffnew left">                RF_overview(i).SC_Box_RF = false;                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1088" data-right-line="628"><a>1088</a> <span class="diffnew left">            end                                                                  &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1089" data-right-line="628"><a>1089</a> <span class="diffnew left">        catch                                                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1090" data-right-line="628"><a>1090</a> <span class="diffnew left">            RF_overview(i).SC_Box_RF = false;                                    &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1091" data-right-line="628"><a>1091</a> <span class="diffnew left">        end                                                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1092" data-right-line="628"><a>1092</a> <span class="diffnew left">        RF_overview(i).cell_idx = cell_indices_temp(i);                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1093" data-right-line="628"><a>1093</a> <span class="diffnew left">    end                                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1094" data-right-line="628"><a>1094</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1095" data-right-line="628"><a>1095</a> <span class="diffnew left">    if bb == 1                                                                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1096" data-right-line="628"><a>1096</a> <span class="diffnew left">        save_location = sf_organizer(stim_idx,savepath,'subfoldername',subfolder &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1097" data-right-line="628"><a>1097</a> <span class="diffnew left">            'variable_name','RF_overview');                                      &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1098" data-right-line="628"><a>1098</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1099" data-right-line="628"><a>1099</a> <span class="diffnew left">    else                                                                         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1100" data-right-line="628"><a>1100</a> <span class="diffnew left">            %Create matfile and attach files to existing batch                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1101" data-right-line="628"><a>1101</a> <span class="diffnew left">        M = matfile(save_location,'Writable',true);                              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1102" data-right-line="628"><a>1102</a> <span class="diffnew left">        M.RF_overview(1,batch_begins(bb):batch_ends(bb)) = RF_overview;          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1103" data-right-line="628"><a>1103</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1104" data-right-line="628"><a>1104</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1105" data-right-line="628"><a>1105</a> <span class="diffnew left">    end                                                                          &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1106" data-right-line="628"><a>1106</a> <span class="diffnew left">end                                                                              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1107" data-right-line="628"><a>1107</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1108" data-right-line="628"><a>1108</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1109" data-right-line="628"><a>1109</a> <span class="diffnew left">clear RF_Ident                                                                   &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1110" data-right-line="628"><a>1110</a> <span class="diffnew left">clear RF_overview                                                                &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1111" data-right-line="628"><a>1111</a> <span class="diffnew left">end                                                                              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1112" data-right-line="628"><a>1112</a> <span class="diffnew left">end                                                                              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="1113" data-right-line="629"><a>1113</a> toc;                                                                             . toc;                                                                             <span><a>629</a></span></span>
<span class="nodiff" data-left-line="1114" data-right-line="630"><a>1114</a>                                                                                  .                                                                                  <span><a>630</a></span></span>
<div id="diff80"><span class="diffLine" data-left-line="1115" data-right-line="630"><a>1115</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1116" data-right-line="630"><a>1116</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1117" data-right-line="630"><a>1117</a> <span class="diffnew left">out = 1;                                                                         &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1118" data-right-line="630"><a>1118</a> <span class="diffnew left">end                                                                              &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1119" data-right-line="630"><a>1119</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1120" data-right-line="630"><a>1120</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1121" data-right-line="630"><a>1121</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1122" data-right-line="630"><a>1122</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
<span class="diffLine" data-left-line="1123" data-right-line="630"><a>1123</a> <span class="diffnew left">                                                                                 &lt; </span><span class="diffold">                                                                                </span> <span class="diffsoft">  -</span></span>
</div><span class="nodiff" data-left-line="1124" data-right-line="631"><a>1124</a> %% Save Data                                                                     . %% Save Data                                                                     <span><a>631</a></span></span>
<span class="nodiff" data-left-line="1125" data-right-line="632"><a>1125</a> %save('Save_Name.mat','-v7.3')                                                   . %save('Save_Name.mat','-v7.3')                                                   <span><a>632</a></span></span>
<span class="nodiff" data-left-line="1126" data-right-line="633"><a>1126</a>                                                                                  .                                                                                  <span><a>633</a></span></span>
                                                                       <span class="diffskip">[2 unmodified lines hidden]</span>
</pre></div></div><div id="bottom"><p>Number of matching lines: 432</p><p>Number of unmatched lines in left file: 696</p>
<p>Number of unmatched lines in right file: 203</p>
</div></body></head>